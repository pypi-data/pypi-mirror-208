import{a as S,bp as g,b as P,c as f,o as d,e as _,w as c,k as p,t as k,bq as Ie,br as Be,g as n,E as w,B,f as D,bs as U,D as y,ar as L,d as b,bt as lt,bu as ct,j as r,aG as K,bo as De,bv as dt,bw as ut,bx as gt,by as Ve,r as re,bz as $e,F as E,bA as xe,N as j,O as Oe,R as Y,bB as Le,bC as pt,bD as ht,W as X,aj as Ee,bb as mt,bE as le,bF as x,ah as _t,ai as vt,bG as ft,Y as ce,bf as kt,bH as bt,bI as de,bJ as ue,aK as ie,bh as q,be as Pt,b5 as se,aZ as St,bK as wt,M as yt,J as Ct,K as M,au as ne,a$ as ge,aw as Tt,ax as Rt,bL as It,bM as Bt,bN as Dt,bO as Vt,bP as $t,n as pe,p as he,bQ as xt,bR as Ne,bS as Ot,bT as Lt,bU as Et,bV as me,ac as Nt,bg as At,bW as Ht,bX as _e,bY as Ae,bZ as Ut,aD as oe,b_ as Mt,b$ as zt,c0 as Wt,c1 as Ft,c2 as Gt,c3 as Kt,c4 as qt,c5 as jt,c6 as Yt,c7 as Xt,q as Zt,v as Jt,V as ve,bn as He,C as fe,bm as Qt,c8 as eo,bk as ke,c9 as to}from"./admin-3f928f18.js";import{_ as Z,a as Ue,b as Me,P as oo,c as ze}from"./metadata-dialog-29ae199b.js";const ao={name:"ReaderNavButton",components:{PaginationNavButton:Z},props:{value:{type:Number,required:!0},twoPages:{type:Boolean,default:!1}},computed:{...S(g,{storePage:e=>e.page,vertical:e=>{var t;return(t=e.activeSettings)==null?void 0:t.vertical},toRoute(e){return{params:{pk:e.pk,page:this.value}}}}),title(){return"to page "+this.value},disabled(){return this.value===this.storePage||this.twoPages&&!!(this.value%2)&&this.value-1===this.storePage}},methods:{...P(g,["setActivePage"]),onClick(){this.setActivePage(this.value,!0)}}};function so(e,t,a,l,i,o){const s=Z;return e.vertical?(d(),_(s,{key:0,disabled:o.disabled,title:o.title,onClick:o.onClick},{default:c(()=>[p(k(a.value),1)]),_:1},8,["disabled","title","onClick"])):(d(),_(s,{key:1,disabled:o.disabled,title:o.title,to:e.toRoute},{default:c(()=>[p(k(a.value),1)]),_:1},8,["disabled","title","to"]))}const We=f(ao,[["render",so]]),no={name:"ReaderBookChangeNavButton",components:{PaginationNavButton:Z},props:{direction:{type:String,required:!0}},computed:{...S(g,{toRoute(e){const t=e.routes.books;if(!t)return"";const a=t[this.direction];return a?{params:{...a}}:""}}),title(){return(this.direction==="prev"?"Previous":"Next")+" Book"},icon(){return this.direction==="prev"?Ie:Be},disabled(){return!this.toRoute}}};function ro(e,t,a,l,i,o){const s=Z;return d(),_(s,{icon:"",variant:"plain",disabled:o.disabled,title:o.title,to:e.toRoute},{default:c(()=>[n(w,null,{default:c(()=>[p(k(o.icon),1)]),_:1})]),_:1},8,["disabled","title","to"])}const Fe=f(no,[["render",ro]]),F="prev",G="next",io={name:"ReaderNavToolbar",components:{PaginationSlider:Ue,ReaderNavButton:We,PaginationToolbar:Me,ReaderBookChangeNavButton:Fe},computed:{...B(g,["activeSettings","activeBook"]),...S(g,{storePage:e=>e.page,key(e){return`${e.pk} - ${this.twoPages}`}}),maxPage(){return this.activeBook?this.activeBook.maxPage:0},twoPages(){return this.activeSettings.twoPages},step(){return this.activeSettings.twoPages?2:1},trackColor(){return this.twoPages&&+this.storePage>=this.maxPage-1?this.$vuetify.theme.current.colors.primary:""},readInReverse(){return this.activeSettings.readInReverse},min(){return this.readInReverse?this.maxPage:0},max(){return this.readInReverse?0:this.maxPage},bookPrev(){return this.readInReverse?"next":"prev"},bookNext(){return this.readInReverse?"prev":"next"}},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...P(g,["routeToBook","routeToDirection","routeToDirectionOne","routeToPage","setActivePage"]),onSliderUpdate(e){this.activeSettings.vertical?this.setActivePage(e,!0):this.routeToPage(e)},_keyListener(e){switch(e.stopPropagation(),e.key){case" ":!e.shiftKey&&window.innerHeight+window.scrollY+1>=document.body.scrollHeight?this.routeToDirection(G):e.shiftKey&&window.scrollY===0&&this.routeToDirection(F);break;case"j":case"ArrowRight":this.routeToDirection(G);break;case"k":case"ArrowLeft":this.routeToDirection(F);break;case",":this.routeToDirectionOne(F);break;case".":this.routeToDirectionOne(G);break;case"n":this.routeToBook(G);break;case"p":this.routeToBook(F);break}}}};function lo(e,t,a,l,i,o){const s=Fe,u=We,h=Ue,I=Me;return o.maxPage?(d(),_(I,{key:0},{default:c(()=>[n(s,{direction:o.bookPrev},null,8,["direction"]),n(u,{value:o.min,"two-pages":o.twoPages},null,8,["value","two-pages"]),(d(),_(h,{key:e.key,"model-value":e.storePage,min:0,max:o.maxPage,step:o.step,"track-color":o.trackColor,reverse:o.readInReverse,"onUpdate:modelValue":t[0]||(t[0]=V=>o.onSliderUpdate(V))},null,8,["model-value","max","step","track-color","reverse"])),n(u,{value:o.max,"two-pages":o.twoPages},null,8,["value","two-pages"]),n(s,{direction:o.bookNext},null,8,["direction"])]),_:1})):D("",!0)}const Ge=f(io,[["render",lo]]),co={rel:"prefetch",as:"image"},Ke=function(e){const t=[];for(const a of e)a&&t.push({...co,href:a});return{link:t}};const uo={name:"PageChangeLink",props:{direction:{type:String,required:!0}},head(){return Ke([this.prefetchSrc1,this.prefetchSrc2])},computed:{...S(g,{params(e){return e.routes[this.computedDirection]},prefetchSrc2(e){const t=e.books.get(this.params.pk);if(!t||!this.getSettings(t).twoPages)return!1;const l={...this.params,page:this.params.page+1};return l.page>t.maxPage?!1:U(l)},directionClass(e){let t=this.direction;return e.activeSettings.vertical&&(t+="Vertical"),t},pageChangeClass(e){let t="pageChange";return t+=e.activeSettings.vertical?"Row":"Column",t}}),computedDirection(){return this.normalizeDirection(this.direction)},prefetchSrc1(){return this.params?U(this.params):!1},route(){return this.params?{params:this.params}:{}},label(){return`${this.computedDirection==="prev"?"Previous":"Next"} Page`}},methods:{...P(g,["getSettings","normalizeDirection"])}};function go(e,t,a,l,i,o){const s=y("router-link");return d(),_(s,{to:o.route,"aria-label":o.label,class:L({[e.pageChangeClass]:!0,[e.directionClass]:!0}),onClick:t[0]||(t[0]=u=>u.stopImmediatePropagation())},null,8,["to","aria-label","class"])}const qe=f(uo,[["render",go],["__scopeId","data-v-29292846"]]);const po={name:"LoadingPage",components:{Placeholder:oo},props:{twoPages:{type:Boolean,required:!0}}};function ho(e,t,a,l,i,o){const s=y("Placeholder");return d(),b("div",{class:L(["pageLoading",{twoPages:a.twoPages}])},[n(s,{class:"pagePlaceholder"})],2)}const mo=f(po,[["render",ho],["__scopeId","data-v-13c9bf0b"]]);const be="unauthorized",_o={name:"ErrorPage",props:{twoPages:{type:Boolean,required:!0},type:{type:String,required:!0}},computed:{text(){return this.type===be?"Protected page":"Failed to load page"},icon(){return this.type===be?lt:ct}}},vo={class:"pageErrorContainer"},fo={class:"pageErrorText"};function ko(e,t,a,l,i,o){return d(),b("div",{class:L(["pageError",{twoPages:a.twoPages}])},[r("div",vo,[r("div",fo,k(o.text),1),n(w,{class:"pageErrorIcon"},{default:c(()=>[p(k(o.icon),1)]),_:1})])],2)}const bo=f(_o,[["render",ko],["__scopeId","data-v-3f1e3f4f"]]);const Po={name:"ImgPage",props:{src:{type:String,required:!0},fitToClass:{type:Object,required:!0}},emits:["load","error"]},So=["src"];function wo(e,t,a,l,i,o){return d(),b("img",K({class:a.fitToClass,src:a.src},e.$attrs,{onError:t[0]||(t[0]=s=>e.$emit("error")),onLoad:t[1]||(t[1]=s=>e.$emit("load"))}),null,16,So)}const Pe=f(Po,[["render",wo],["__scopeId","data-v-5997abff"]]);const Se=De(dt(()=>gt(()=>import("./page-pdf-e70f0ee6.js"),["assets/page-pdf-e70f0ee6.js","assets/admin-3f928f18.js","assets/admin-295bb85f.css","assets/page-pdf-2d7d4f5d.css"]))),yo=333,Co={S:"Screen",W:"Width",H:"Height",O:"Original"},To={name:"BookPage",components:{ErrorPage:bo,LoadingPage:mo,PDFPage:Se,ImgPage:Pe},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},data(){return{showProgress:!1,loaded:!1,error:!1}},computed:{pageClass(){return this.settings.vertical?"pageVertical":"pageHorizontal"},fitToClass(){let e={};const t=Co[this.settings.fitTo];if(t){let a="fitTo";a+=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase(),this.settings.twoPages&&(a+="Two",this.settings.vertical&&(a+="Vertical")),e[a]=!0}return e},src(){const e={pk:this.book.pk,page:this.page};return U(e)},component(){return this.book.fileType==="PDF"?Se:Pe},settings(){return this.getSettings(this.book)}},mounted(){setTimeout(function(){this.loaded||(this.loading=!0)},yo)},methods:{...P(g,["getSettings"]),onLoad(){this.showProgress=!1,this.loaded=!0,this.error=!1},onError(){this.error="load",this.showProgress=!1},onUnauthorized(){this.error="unauthorized",this.showProgress=!1}}},Ro=["id","data-page"];function Io(e,t,a,l,i,o){const s=y("ErrorPage"),u=y("LoadingPage");return d(),b("div",{id:`page${a.page}`,"data-page":a.page,class:L(o.pageClass)},[i.error?(d(),_(s,{key:0,"two-pages":o.settings.twoPages,type:i.error},null,8,["two-pages","type"])):i.showProgress&&!i.loaded?(d(),_(u,{key:1,"two-pages":o.settings.twoPages},null,8,["two-pages"])):(d(),_(ut(o.component),{key:2,src:o.src,"fit-to-class":o.fitToClass,book:a.book,onError:o.onError,onLoad:o.onLoad,onUnauthorized:o.onUnauthorized},null,40,["src","fit-to-class","book","onError","onLoad","onUnauthorized"]))],10,Ro)}const je=f(To,[["render",Io],["__scopeId","data-v-f9e0354b"]]);const Bo=48,Do=48,Vo={name:"PagesHorizontalWindow",components:{BookPage:je,PageChangeLink:qe},props:{book:{type:Object,required:!0}},data(){return{activePage:0,pages:[]}},computed:{...B(g,["isOnCoverPage"]),...S(g,{prevBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.prev},nextBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.next},storePage:e=>e.page,storePk:e=>e.pk}),settings(){return this.getSettings(this.book)},twoPages(){return this.settings.twoPages},readInReverse(){return this.settings.readInReverse},secondPage(){return this.settings.twoPages&&!this.isOnCoverPage},windowIndex(){const e=this.activePage-this.pages[0];return Math.min(Math.max(0,e),this.book.maxPage)}},watch:{twoPages(){this.setActivePage(this.storePage,!0)},storePage(e){if(this.book.pk===this.storePk){this.activePage=e;const t=this.pages.at(0),a=this.pages.at(-1);(e<t||e>a)&&this.setPages()}},prevBook(e){this.book.pk===e.pk&&(this.activePage=this.book.maxPage)},nextBook(e){this.book.pk===e.pk&&(this.activePage=0)}},created(){this.book.pk===this.storePk?this.activePage=+this.$route.params.page:this.book.pk===this.prevBook.pk?this.activePage=this.book.maxPage:this.activePage=0,this.setPages()},methods:{...P(g,["getSettings","setBookChangeFlag","setActivePage"]),setPages(){const e=Math.max(this.activePage-Bo,0),t=Math.min(this.activePage+Do,this.book.maxPage),a=Ve.range(e,t+1);this.pages=a}}};function $o(e,t,a,l,i,o){const s=qe,u=y("BookPage");return d(),_(xe,{"show-arrows":"",continuous:"","model-value":o.windowIndex,reverse:o.readInReverse},{prev:c(()=>[n(s,{direction:"prev"})]),next:c(()=>[n(s,{direction:"next"})]),default:c(()=>[(d(!0),b(E,null,re(i.pages,h=>(d(),_($e,{key:`c/${a.book.pk}/${h}`,class:"windowItem",disabled:"",eager:h>=e.storePage-1&&h<=e.storePage+2,"model-value":h,transition:!0},{default:c(()=>[!o.readInReverse||o.secondPage&&h<a.book.maxPage?(d(),_(u,{key:0,book:a.book,page:o.readInReverse?h+1:h},null,8,["book","page"])):D("",!0),o.readInReverse||o.secondPage&&h<a.book.maxPage?(d(),_(u,{key:1,book:a.book,page:o.readInReverse?h:h+1},null,8,["book","page"])):D("",!0)]),_:2},1032,["eager","model-value"]))),128))]),_:1},8,["model-value","reverse"])}const xo=f(Vo,[["render",$o],["__scopeId","data-v-da9ab604"]]);const Oo=j({dynamicHeight:Boolean,...Oe()},"v-virtual-scroll-item"),Lo=Y()({name:"VVirtualScrollItem",props:Oo(),emits:{"update:height":e=>!0},setup(e,t){let{emit:a,slots:l}=t;const{resizeRef:i,contentRect:o}=Le();pt(()=>e.dynamicHeight,()=>{Ee(()=>{var u;return(u=o.value)==null?void 0:u.height},u=>{u!=null&&a("update:height",u)})});function s(){e.dynamicHeight&&o.value&&a("update:height",o.value.height)}ht(s),X(()=>{var u;return n("div",{ref:e.dynamicHeight?i:void 0,class:["v-virtual-scroll__item",e.class],style:e.style},[(u=l.default)==null?void 0:u.call(l)])})}}),we=-1,ye=1,Eo=j({items:{type:Array,default:()=>[]},itemHeight:[Number,String],...Oe(),...mt()},"v-virtual-scroll"),No=Y()({name:"VVirtualScroll",props:Eo(),setup(e,t){let{slots:a}=t;const l=le(0),i=le(e.itemHeight),o=x({get:()=>parseInt(i.value??0,10),set(m){i.value=m}}),s=_t(),{resizeRef:u,contentRect:h}=Le();vt(()=>{u.value=s.value});const I=ft(),V=new Map;let R=ce(e.items.length).map(()=>o.value);const N=x(()=>{var m;return Math.max(12,Math.ceil((((m=h.value)==null?void 0:m.height)??I.height.value)/o.value*1.7+1))});function A(m,v){o.value=Math.max(o.value,v),R[m]=v,V.set(e.items[m],v)}function $(m){return R.slice(0,m).reduce((v,C)=>v+(C||o.value),0)}function H(m){const v=e.items.length;let C=0,O=0;for(;O<m&&C<v;)O+=R[C++]||o.value;return C-1}let z=0;function J(){if(!s.value||!h.value)return;const m=h.value.height,v=s.value.scrollTop,C=v<z?we:ye,O=H(v+m/2),W=Math.round(N.value/3);C===we&&O<=l.value+W*2-1?l.value=ue(O-W,0,e.items.length):C===ye&&O>=l.value+W*2-1&&(l.value=ue(O-W,0,e.items.length-N.value)),z=s.value.scrollTop}function Q(m){if(!s.value)return;const v=$(m);s.value.scrollTop=v}const ee=x(()=>e.items.map((m,v)=>({raw:m,index:v}))),te=x(()=>Math.min(e.items.length,l.value+N.value)),st=x(()=>ee.value.slice(l.value,te.value)),nt=x(()=>$(l.value)),rt=x(()=>$(e.items.length)-$(te.value)),{dimensionStyles:it}=kt(e);return bt(()=>{o.value||(o.value=R.slice(l.value,te.value).reduce((m,v)=>m+v,0)/N.value)}),Ee(()=>e.items.length,()=>{R=ce(e.items.length).map(()=>o.value),V.forEach((m,v)=>{const C=e.items.indexOf(v);C===-1?V.delete(v):R[C]=m})}),X(()=>n("div",{ref:s,class:["v-virtual-scroll",e.class],onScroll:J,style:[it.value,e.style]},[n("div",{class:"v-virtual-scroll__container",style:{paddingTop:de(nt.value),paddingBottom:de(rt.value)}},[st.value.map(m=>n(Lo,{key:m.index,dynamicHeight:!e.itemHeight,"onUpdate:height":v=>A(m.index,v)},{default:()=>{var v;return[(v=a.default)==null?void 0:v.call(a,{item:m.raw,index:m.index})]}}))])])),{scrollToIndex:Q}}});function Ye(e,t){const{self:a=!1}=t.modifiers??{},l=t.value,i=typeof l=="object"&&l.options||{passive:!0},o=typeof l=="function"||"handleEvent"in l?l:l.handler,s=a?e:t.arg?document.querySelector(t.arg):window;s&&(s.addEventListener("scroll",o,i),e._onScroll=Object(e._onScroll),e._onScroll[t.instance.$.uid]={handler:o,options:i,target:a?void 0:s})}function Xe(e,t){var o;if(!((o=e._onScroll)!=null&&o[t.instance.$.uid]))return;const{handler:a,options:l,target:i=e}=e._onScroll[t.instance.$.uid];i.removeEventListener("scroll",a,l),delete e._onScroll[t.instance.$.uid]}function Ao(e,t){t.value!==t.oldValue&&(Xe(e,t),Ye(e,t))}const Ho={mounted:Ye,unmounted:Xe,updated:Ao},Uo=12,Ce=250,Te={threshold:[.75]},Mo={S:Te,H:Te},zo={name:"PagesVerticalScroller",components:{BookPage:je},props:{book:{type:Object,required:!0}},data(){return{innerHeight:window.innerHeight,innerWidth:window.innerWidth,intersectorOn:!1,programmaticScroll:!1}},computed:{...S(g,{storePage:e=>e.page}),...ie(g,["reactWithScroll"]),settings(){return this.getSettings(this.book)},readInReverse(){return this.settings.readInReverse},items(){var a;const e=((a=this.book)==null?void 0:a.maxPage)+1,t=Ve.range(0,e);return this.readInReverse&&t.reverse(),t},visibleItems(){var e;return Math.min(((e=this.book)==null?void 0:e.maxPage)??0,Uo)},intersectOptions(){return Mo[this.settings.fitTo]}},watch:{storePage(e){this.reactWithScroll&&this.scrollToPage(e)}},mounted(){window.addEventListener("resize",this.onResize),setTimeout(()=>{this.scrollToPage(this.storePage)},Ce)},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{...P(g,["setActivePage","setBookChangeFlag","getSettings"]),onIntersect(e,t){if(e&&this.intersectorOn){const l=+t[0].target.dataset.page;this.setActivePage(l,!1)}},onScroll(){if(this.programmaticScroll)return;this.intersectorOn=!0;const e=this.$refs.verticalScroll.$el,t=e.scrollTop;if(this.storePage===0&&t===0)this.setBookChangeFlag("prev");else if(this.storePage===this.book.maxPage){const a=e.scrollTopMax||e.scrollHeight-e.clientTop;window.innerHeight+t+1>=a&&this.setBookChangeFlag("next")}},scrollToPage(e){this.intersectorOn=!1,this.programmaticScroll=!0;const t=this.$refs.verticalScroll;t?t.scrollToIndex(e):console.debug("Can't find vertcalScroll component."),setTimeout(()=>{this.programmaticScroll=!1},Ce)},onResize(){this.innerHeight=window.innerHeight,this.innerWidth=window.innerWidth}}},Wo=["data-page"];function Fo(e,t,a,l,i,o){const s=y("BookPage");return q((d(),_(No,{id:"verticalScroll",ref:"verticalScroll",items:o.items,height:i.innerHeight,width:i.innerWidth},{default:c(({item:u})=>[n(s,{book:a.book,page:u},null,8,["book","page"]),q(r("div",{class:"pageTracker","data-page":u},null,8,Wo),[[Pt,{handler:o.onIntersect,options:o.intersectOptions},void 0,{quiet:!0}]])]),_:1},8,["items","height","width"])),[[Ho,o.onScroll,"#verticalScroll"]])}const Go=f(zo,[["render",Fo],["__scopeId","data-v-c5c4cded"]]),Ko={name:"PagesView",components:{PagesHorizontalWindow:xo,PagesVerticalScroller:Go},props:{book:{type:Object,required:!0}},emits:["click"],computed:{...S(g,{storePk:e=>e.pk}),settings(){return this.getSettings(this.book)},vertical(){return this.settings.vertical}},watch:{$route(e){+e.params.pk===this.book.pk&&this.setActivePage(+e.params.page,!0)}},created(){this.book.pk===this.storePk&&this.setActivePage(+this.$route.params.page,!0)},methods:{...P(g,["getSettings","setActivePage"])}};function qo(e,t,a,l,i,o){const s=y("PagesVerticalScroller"),u=y("PagesHorizontalWindow");return o.vertical?(d(),_(s,{key:0,book:a.book,onClick:e.$emit.click},null,8,["book","onClick"])):(d(),_(u,{key:1,book:a.book,onClick:e.$emit.click},null,8,["book","onClick"]))}const Ze=f(Ko,[["render",qo]]);const jo={name:"BookChangeActivator",props:{direction:{type:String,required:!0}},computed:{...B(g,["prevBookChangeShow","nextBookChangeShow"]),show(){return this[this.computedDirection+"BookChangeShow"]},computedDirection(){return this.normalizeDirection(this.direction)}},methods:{...P(g,["setBookChangeFlag","normalizeDirection"])}};function Yo(e,t,a,l,i,o){return o.show?(d(),b("div",{key:0,class:L(["bookChangeColumn",{[a.direction]:!0}]),onClick:t[0]||(t[0]=se(s=>e.setBookChangeFlag(a.direction),["stop"]))},null,2)):D("",!0)}const Je=f(jo,[["render",Yo],["__scopeId","data-v-2a8ea6a5"]]);const Xo={name:"BooksWindow",components:{BookChangeActivator:Je,PagesView:Ze},emits:["click"],computed:{...S(g,{books:e=>e.books,bookChange:e=>e.bookChange,activeBookPk:e=>e.pk,bookRoutes:e=>e.routes.books})},watch:{$route(e,t){(!t||!t.params||+e.params.pk!=+t.params.pk)&&this.loadBooks(e.params)}},beforeMount(){this.setBookChangeFlag()},created(){this.loadBooks(this.$route.params)},methods:{...P(g,["setBookChangeFlag","loadBooks"]),click(){this.setBookChangeFlag(),this.$emit("click")},eager(e){return this.bookChange&&this.bookRoutes[this.bookChange]&&this.bookRoutes[this.bookChange].pk===e}}};function Zo(e,t,a,l,i,o){const s=Je,u=Ze;return d(),_(xe,{id:"booksWindow",direction:"vertical","model-value":e.activeBookPk,"show-arrows":"",onClick:o.click},{prev:c(()=>[n(s,{direction:"prev"})]),next:c(()=>[n(s,{direction:"next"})]),default:c(()=>[(d(!0),b(E,null,re(e.books,([h,I])=>(d(),_($e,{key:`c/${h}`,class:"windowItem",disabled:"",eager:o.eager(h),value:h,transition:!0},{default:c(()=>[n(u,{book:I,onClick:o.click},null,8,["book","onClick"])]),_:2},1032,["eager","value"]))),128))]),_:1},8,["model-value","onClick"])}const Qe=f(Xo,[["render",Zo],["__scopeId","data-v-ca6f1824"]]);const Jo={name:"ReaderTitleToolbar",components:{MetadataDialog:ze,SettingsDrawerButton:St},data(){return{mdiClose:wt,routeChanged:!1}},head(){return{meta:[{hid:"description",name:"description",content:`reader ${this.activeTitle} page ${this.storePage}`}]}},computed:{...B(g,["activeTitle","activeBook"]),...S(g,{bookChange:e=>e.bookChange,seriesPosition:function(e){return this.activeBook&&e.seriesCount>1?`${this.activeBook.seriesIndex}/${e.seriesCount}`:""},vertical:e=>e.activeSettings.vertical,pk:e=>e.pk||0}),...S(yt,{lastRoute:e=>e.page.routes.last}),...ie(M,["isSettingsDrawerOpen"]),closeBookRoute:function(){const e={name:"browser",params:this.lastRoute};return e.params?e.hash=`#card-${this.pk}`:e.params=window.CODEX.LAST_ROUTE||Ct.browser.route,e}},watch:{$route(e,t){t&&(this.routeChanged=!0)}},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...P(M,["setTimestamp"]),...P(g,["routeToDirection","routeToDirectionOne","routeToBook","setBookChangeFlag"]),openMetadata(){this.$refs.metadataDialog.dialog=!0},onCloseBook(){this.routeChanged&&this.setTimestamp()},_keyListener(e){switch(e.stopPropagation(),e.key){case"Escape":this.$refs.closeBook.$el.click();break;case"m":this.openMetadata();break}}}},Qo={key:0},ea={key:0,id:"seriesPosition",title:"Series Position"};function ta(e,t,a,l,i,o){const s=ze,u=y("SettingsDrawerButton");return d(),_(Rt,{id:"readerTopToolbar",class:"codexToolbar",density:"compact"},{default:c(()=>[n(ge,null,{default:c(()=>[n(ne,{id:"closeBook",ref:"closeBook",to:o.closeBookRoute,size:"large",onClick:o.onCloseBook},{default:c(()=>[e.$vuetify.display.smAndDown?(d(),_(w,{key:1,title:"Close Book"},{default:c(()=>[p(k(i.mdiClose),1)]),_:1})):(d(),b("span",Qo,"close book"))]),_:1},8,["to","onClick"])]),_:1}),p(" "+k(e.bookChange)+" ",1),n(Tt,{id:"toolbarTitle",class:"codexToolbarTitle"},{default:c(()=>[p(k(e.activeTitle),1)]),_:1}),e.seriesPosition?(d(),b("span",ea,k(e.seriesPosition),1)):D("",!0),n(ge,null,{default:c(()=>[n(ne,{id:"tagButton",onClick:se(o.openMetadata,["stop"])},{default:c(()=>[n(s,{ref:"metadataDialog",group:"c",pk:e.pk},null,8,["pk"])]),_:1},8,["onClick"]),n(u,{id:"settingsButton",onClick:t[0]||(t[0]=se(h=>e.isSettingsDrawerOpen=!0,["stop"]))})]),_:1})]),_:1})}const et=f(Jo,[["render",ta],["__scopeId","data-v-4075b1a2"]]);const oa={name:"BookChangeDrawer",props:{direction:{type:String,required:!0}},head(){return Ke([this.prefetchSrc1,this.prefetchSrc2])},computed:{...B(g,["prevBookChangeShow","nextBookChangeShow"]),...S(g,{prefetchSrc2(e){if(!this.params)return!1;const t=e.books.get(this.params.pk),a=this.getSettings(t);if(!this.isDrawerOpen||!this.params||!a.twoPages)return!1;const l={pk:this.params.pk,page:this.params.page+1};return U(l)},isDrawerOpen(e){return e.bookChange===this.computedDirection},params(e){return e.routes.books[this.computedDirection]},icon(){return this.computedDirection==="next"?Be:Ie}}),show(){return this[this.computedDirection+"BookChangeShow"]},prefetchSrc1(){return!this.isDrawerOpen||!this.params?!1:U(this.params)},route(){return this.params?{params:this.params}:{}},label(){return`${this.computedDirection==="prev"?"Previous":"Next"} Book`},computedDirection(){return this.normalizeDirection(this.direction)}},methods:{...P(g,["getSettings","normalizeDirection"])}};function aa(e,t,a,l,i,o){const s=y("router-link");return o.show?(d(),_(It,{key:0,class:L({bookChangeDrawer:!0,[a.direction]:!0}),"disable-resize-watcher":"","disable-route-watcher":"",location:o.computedDirection==="prev"?"left":"right","model-value":e.isDrawerOpen,scrim:!1,temporary:"",touchless:""},{default:c(()=>[n(s,{class:"navLink",to:o.route,"aria-label":o.label,title:o.label,onClick:t[0]||(t[0]=u=>u.stopImmediatePropagation())},{default:c(()=>[n(w,{class:"bookChangeIcon"},{default:c(()=>[p(k(e.icon),1)]),_:1})]),_:1},8,["to","aria-label","title"])]),_:1},8,["class","location","model-value"])):D("",!0)}const tt=f(oa,[["render",aa],["__scopeId","data-v-33b1e110"]]);const sa={name:"DownloadPanel",data(){return{mdiDownload:Bt,mdiFileImage:Dt}},computed:{...B(g,["activeTitle"]),...S(g,{storePage:e=>e.page,pageSrc(e){const t={pk:e.pk,page:e.page};return Vt(t)},downloadURL(e){return $t(e.pk)}}),...B(g,["activeBook"]),pageName:function(){return`${this.activeTitle} - page ${this.storePage}.jpg`}},methods:{...P(M,["downloadIOSPWAFix"]),downloadPage(){this.downloadIOSPWAFix(this.pageSrc,this.pageName)},downloadBook(){this.downloadIOSPWAFix(this.downloadURL,this.activeBook.filename)}}},na={id:"downloadPanel"};function ra(e,t,a,l,i,o){return d(),b("div",na,[n(he,{onClick:o.downloadPage},{default:c(()=>[n(pe,null,{default:c(()=>[n(w,null,{default:c(()=>[p(k(i.mdiFileImage),1)]),_:1}),p("Download Page "+k(e.storePage),1)]),_:1})]),_:1},8,["onClick"]),n(he,{onClick:o.downloadBook},{default:c(()=>[n(pe,null,{default:c(()=>[n(w,null,{default:c(()=>[p(k(i.mdiDownload),1)]),_:1}),p("Download Book ")]),_:1})]),_:1},8,["onClick"])])}const ot=f(sa,[["render",ra],["__scopeId","data-v-c3777662"]]);const ia=j({...xt({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"v-radio"),ae=Y()({name:"VRadio",props:ia(),setup(e,t){let{slots:a}=t;return X(()=>n(Ne,K(e,{class:["v-radio",e.class],style:e.style,type:"radio"}),a)),{}}});const la=j({height:{type:[Number,String],default:"auto"},...Ot(),...Lt(Et(),["multiple"]),trueIcon:{type:me,default:"$radioOn"},falseIcon:{type:me,default:"$radioOff"},type:{type:String,default:"radio"}},"v-radio-group"),Re=Y()({name:"VRadioGroup",inheritAttrs:!1,props:la(),emits:{"update:modelValue":e=>!0},setup(e,t){let{attrs:a,slots:l}=t;const i=Nt(),o=x(()=>e.id||`radio-group-${i}`),s=At(e,"modelValue");return X(()=>{const[u,h]=Ht(a),[I,V]=_e.filterProps(e),[R,N]=Ne.filterProps(e),A=l.label?l.label({label:e.label,props:{for:o.value}}):e.label;return n(_e,K({class:["v-radio-group",e.class],style:e.style},u,I,{modelValue:s.value,"onUpdate:modelValue":$=>s.value=$,id:o.value}),{...l,default:$=>{let{id:H,messagesId:z,isDisabled:J,isReadonly:Q}=$;return n(E,null,[A&&n(Ae,{id:H.value},{default:()=>[A]}),n(Ut,K(R,{id:H.value,"aria-describedby":z.value,defaultsTarget:"VRadio",trueIcon:e.trueIcon,falseIcon:e.falseIcon,type:e.type,disabled:J.value,readonly:Q.value,"aria-labelledby":A?H.value:void 0,multiple:!1},h,{modelValue:s.value,"onUpdate:modelValue":ee=>s.value=ee}),l)])}})}),{}}}),ca=["fitTo","twoPages","vertical","readInReverse"],da={name:"ReaderSettingsPanel",data(){return{isGlobalScope:!1}},computed:{...S(g,{fitToChoices(e){const t=[];for(const a of e.choices.fitTo)a.value&&t.push(a);return t},selectedSettings:function(e){return this.isGlobalScope||!e.activeBook?e.readerSettings:e.activeBook.settings},isClearSettingsButtonDisabled:function(e){if(this.isGlobalScope||!e.activeBook)return!0;for(const t of ca){const a=e.activeBook.settings[t];if(!e.choices.nullValues.has(a))return!1}return!0},verticalLabel(e){const t=e.activeBook&&e.activeBook.settings?e.activeBook.settings.vertical:void 0;return t==null?"Horizontal or Vertical":t?"Scroll Pages Vertically":"Turn Pages Horizontally"},params(e){return{pk:e.pk,page:e.page}}}),...ie(g,["readRTLInReverse"])},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...P(g,["clearSettingsLocal","setSettingsGlobal","setSettingsLocal"]),settingsDialogChanged:function(e){this.isGlobalScope?this.setSettingsGlobal(this.params,e):this.setSettingsLocal(this.params,e)},_keyListener:function(e){e.stopPropagation();let t;switch(e.key){case"w":t={fitTo:"W"};break;case"h":t={fitTo:"H"};break;case"s":t={fitTo:"S"};break;case"o":t={fitTo:"O"};break;case"2":t={twoPages:!this.selectedSettings.twoPages};break;case"r":t={readInReverse:!this.selectedSettings.readInReverse};break;case"v":t={vertical:!this.selectedSettings.vertical}}t&&this.setSettingsLocal(this.params,t)}}},ua={id:"readerSettings"};function ga(e,t,a,l,i,o){return d(),b("div",ua,[n(Re,{modelValue:i.isGlobalScope,"onUpdate:modelValue":t[0]||(t[0]=s=>i.isGlobalScope=s),density:"compact",label:"Scope","hide-details":"auto"},{default:c(()=>[n(ae,{label:"Only this comic",value:!1}),n(ae,{label:"Default for all comics",value:!0})]),_:1},8,["modelValue"]),n(Re,{class:"displayRadioGroup",density:"compact",label:"Display","hide-details":"auto","model-value":e.selectedSettings.fitTo,"onUpdate:modelValue":t[1]||(t[1]=s=>o.settingsDialogChanged({fitTo:s}))},{default:c(()=>[(d(!0),b(E,null,re(e.fitToChoices,s=>(d(),_(ae,{key:s.value,label:s.title,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),n(oe,{disabled:e.selectedSettings.vertical,class:"displayTwoPages",density:"compact",label:"Two pages","hide-details":"auto","model-value":e.selectedSettings.twoPages,"true-value":!0,indeterminate:e.selectedSettings.twoPages===null||e.selectedSettings.twoPages===void 0,"onUpdate:modelValue":t[2]||(t[2]=s=>o.settingsDialogChanged({twoPages:s}))},null,8,["disabled","model-value","indeterminate"]),n(Ae,null,{default:c(()=>[p("Reading Direction")]),_:1}),n(Mt,{class:"vertical",density:"compact",label:e.verticalLabel,"hide-details":"auto","model-value":e.selectedSettings.vertical,"true-value":!0,indeterminate:e.selectedSettings.vertical===null||e.selectedSettings.vertical===void 0,"onUpdate:modelValue":t[3]||(t[3]=s=>o.settingsDialogChanged({vertical:s}))},null,8,["label","model-value","indeterminate"]),n(oe,{class:"readInReverse",density:"compact",label:"Read in Reverse","hide-details":"auto","model-value":e.selectedSettings.readInReverse,"true-value":!0,indeterminate:e.selectedSettings.readInReverse===null||e.selectedSettings.readInReverse===void 0,"onUpdate:modelValue":t[4]||(t[4]=s=>o.settingsDialogChanged({readInReverse:s}))},null,8,["model-value","indeterminate"]),i.isGlobalScope?(d(),_(oe,{key:0,"model-value":e.selectedSettings.readRtlInReverse,class:"readRtlInReverse",density:"compact",label:"Read RTL comics in Reverse","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[5]||(t[5]=s=>o.settingsDialogChanged({readRtlInReverse:s}))},null,8,["model-value"])):D("",!0),i.isGlobalScope?D("",!0):(d(),_(ne,{key:1,id:"clearSettingsButton",disabled:e.isClearSettingsButtonDisabled,title:"Use the default settings for all comics for this comic",onClick:t[6]||(t[6]=s=>e.clearSettingsLocal(e.params))},{default:c(()=>[p(" Clear Comic Settings ")]),_:1},8,["disabled"]))])}const at=f(da,[["render",ga],["__scopeId","data-v-72cc1f00"]]);const pa={name:"KeyboardShortcutsPanel",data(){return{mdiMenuLeft:zt,mdiMenuRight:Wt,mdiKeyboardOutline:Ft,mdiKeyboardSpace:Gt,mdiAppleKeyboardShift:Kt}},computed:{...B(M,["isMobile"])}},T=e=>(Zt("data-v-41483eb9"),e=e(),Jt(),e),ha=T(()=>r("h4",null,"Navigation",-1)),ma={class:"highlight-table"},_a=T(()=>r("td",null,"Previous page",-1)),va=T(()=>r("td",null,"Next page",-1)),fa=T(()=>r("tr",null,[r("td",null,","),r("td",null,[p("Next "),r("em",null,"only"),p(" one page in two page mode.")])],-1)),ka=T(()=>r("tr",null,[r("td",null,"."),r("td",null,[p("Previous "),r("em",null,"only"),p(" one page in two page mode.")])],-1)),ba=T(()=>r("tr",null,[r("td",null,"p"),r("td",null,"Previous Book")],-1)),Pa=T(()=>r("tr",null,[r("td",null,"n"),r("td",null,"Next Book")],-1)),Sa=T(()=>r("h4",null,"Fit Page To",-1)),wa=T(()=>r("table",{class:"highlight-table"},[r("tbody",null,[r("tr",null,[r("td",null,"s"),r("td",null,"screen")]),r("tr",null,[r("td",null,"h"),r("td",null,"screen height")]),r("tr",null,[r("td",null,"w"),r("td",null,"screen width")]),r("tr",null,[r("td",null,"o"),r("td",null,"Show page at original size")]),r("tr",null,[r("td",null,"2"),r("td",null,"Toggle two page view")]),r("tr",null,[r("td",null,"r"),r("td",null,"Toggle Read in Reverse")])])],-1)),ya=T(()=>r("h4",null,"Other",-1)),Ca=T(()=>r("table",{class:"highlight-table"},[r("tbody",null,[r("tr",null,[r("td",null,"m"),r("td",null,"Show comic's metadata")]),r("tr",null,[r("td",null,"esc"),r("td",null,"Close book")])])],-1));function Ta(e,t,a,l,i,o){return e.isMobile?D("",!0):(d(),_(Xt,{key:0},{default:c(()=>[n(qt,{id:"readerKeyboardShortcuts"},{default:c(()=>[n(jt,{id:"shortcutsTitle"},{default:c(()=>[n(w,{id:"keyboardIcon"},{default:c(()=>[p(k(i.mdiKeyboardOutline),1)]),_:1}),p("Keyboard Shortcuts ")]),_:1}),n(Yt,null,{default:c(()=>[ha,r("table",ma,[r("tbody",null,[r("tr",null,[r("td",null,[n(w,{class:"keyIcon",density:"compact"},{default:c(()=>[p(k(i.mdiMenuLeft),1)]),_:1}),p(", j, "),r("div",null,[n(w,{class:"keyIcon",density:"compact"},{default:c(()=>[p(k(i.mdiAppleKeyboardShift),1)]),_:1}),n(w,{class:"keyIcon",density:"compact"},{default:c(()=>[p(k(i.mdiKeyboardSpace),1)]),_:1})])]),_a]),r("tr",null,[r("td",null,[n(w,{class:"keyIcon",density:"compact"},{default:c(()=>[p(k(i.mdiMenuRight),1)]),_:1}),p(", k, "),n(w,{class:"keyIcon",density:"compact"},{default:c(()=>[p(k(i.mdiKeyboardSpace),1)]),_:1})]),va]),fa,ka,ba,Pa])]),Sa,wa,ya,Ca]),_:1})]),_:1})]),_:1}))}const Ra=f(pa,[["render",Ta],["__scopeId","data-v-41483eb9"]]),Ia={name:"ReaderSettingsSuperPanel",components:{DownloadPanel:ot,ReaderKeyboardShortcutsPanel:Ra,ReaderSettingsPanel:at}};function Ba(e,t,a,l,i,o){const s=at,u=y("ReaderKeyboardShortcutsPanel"),h=ot;return d(),b(E,null,[n(s),n(ve),n(u),n(ve),n(h)],64)}const Da=f(Ia,[["render",Ba]]);const Va={name:"MainReader",components:{BookChangeDrawer:tt,BooksWindow:Qe,ReaderNavToolbar:Ge,ReaderTitleToolbar:et,SettingsDrawer:He},data(){return{showToolbars:!1,ReaderSettingsSuperPanel:De(Da)}},computed:{...B(fe,["isCodexViewable"]),...S(fe,{user:e=>e.user})},watch:{user(){this.loadReaderSettings()},isCodexViewable(){this.loadReaderSettings()}},created(){M().isSettingsDrawerOpen=!1,this.loadReaderSettings()},methods:{...P(g,["loadReaderSettings"]),toggleToolbars(){this.showToolbars=!this.showToolbars}}},$a={key:0,id:"readerContainer"},xa={key:1,id:"announcement"};function Oa(e,t,a,l,i,o){const s=tt,u=et,h=Qe,I=Ge,V=y("router-link"),R=He;return d(),b(E,null,[n(Qt,{id:"readerWrapper"},{default:c(()=>[n(s,{direction:"prev"}),e.isCodexViewable?(d(),b("div",$a,[n(eo,null,{default:c(()=>[q(n(u,null,null,512),[[ke,i.showToolbars]])]),_:1}),n(h,{onClick:o.toggleToolbars},null,8,["onClick"]),n(to,null,{default:c(()=>[q(n(I,null,null,512),[[ke,i.showToolbars]])]),_:1})])):(d(),b("div",xa,[r("h1",null,[n(V,{to:{name:"home"}},{default:c(()=>[p(" Log in ")]),_:1}),p(" to read comics ")])]))]),_:1}),n(s,{direction:"next"}),n(R,{title:"Reader Settings",panel:i.ReaderSettingsSuperPanel,temporary:""},null,8,["panel"])],64)}const Na=f(Va,[["render",Oa],["__scopeId","data-v-dff2aac6"]]);export{Na as default};
