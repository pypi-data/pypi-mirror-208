"use strict";(self.webpackChunkjupyterlab_ipyflow=self.webpackChunkjupyterlab_ipyflow||[]).push([[568],{568:(e,t,n)=>{n.r(t),n.d(t,{default:()=>G});var l=n(33),o=n(191),d=n(123),c=n(761),s=n.n(c);const i="ipyflow",a="waiting-cell",r="ready-cell",u="ready-making-cell",m="ready-making-input-cell",f="linked-waiting",h="linked-ready-maker",v=new Event("cleanup");let y=new Set,C=new Set,_=new Set,p={},w={},g=null,x=null,E={},k={},b={},L=null,S=null,j=!1,A=!1,O=null,V=new Set,N=new Set,B=new Set;function D(){y=new Set,C=new Set,_=new Set,p={},w={},g=null,x=null,E={},k={},b={},L=null,S=null,j=!1,A=!1,O=null,V=new Set,N=new Set,B=new Set}const I={id:"jupyterlab-ipyflow",requires:[d.INotebookTracker,l.ICommandPalette],autoStart:!0,activate:(e,t,n)=>{e.commands.addCommand("alt-mode-execute",{label:"Alt Mode Execute",isEnabled:()=>!0,isVisible:()=>!0,isToggled:()=>!1,execute:()=>{const n=t.currentWidget.sessionContext;n.isReady&&(n.session.kernel.name!==i?(e.commands.execute("notebook:enter-command-mode"),o.CodeCell.execute(t.activeCell,n)):A||"code"!==t.activeCell.model.type||(A=!0,e.commands.execute("notebook:enter-command-mode"),n.session.kernel.requestExecute({code:"%flow toggle-reactivity-until-next-reset",silent:!0,store_history:!1}).done.then((()=>{o.CodeCell.execute(t.activeCell,n)}))))}}),e.commands.addKeyBinding({command:"alt-mode-execute",keys:["Accel Shift Enter"],selector:".jp-Notebook"}),e.commands.addKeyBinding({command:"alt-mode-execute",keys:["Ctrl Shift Enter"],selector:".jp-Notebook"}),n.addItem({command:"alt-mode-execute",category:"execution",args:{}}),e.commands.addCommand("alt-execute",{label:"Alt Execute",isEnabled:()=>!0,isVisible:()=>!0,isToggled:()=>!1,execute:()=>{const n=t.currentWidget.sessionContext;n.isReady&&(e.commands.execute("notebook:enter-command-mode"),o.CodeCell.execute(t.activeCell,n))}}),e.commands.addKeyBinding({command:"alt-execute",keys:["Accel Enter"],selector:".jp-Notebook"}),t.widgetAdded.connect(((e,t)=>{const n=t.sessionContext;n.ready.then((()=>{W(t.content);let e=D;n.session.kernel.name===i&&n.ready.then((()=>{e=F(n,t.content)})),n.kernelChanged.connect(((l,o)=>{null!=o.newValue&&(D(),W(t.content),e(),e=D,o.newValue.name===i&&n.ready.then((()=>{e=F(n,t.content)})))}))}))}))}},K=e=>{if(null==e)return null;const t=e.children.item(1);return null===t?null:t.firstElementChild},P=e=>{if(null==e)return null;const t=e.children.item(2);return null===t?null:t.firstElementChild},T=(e,t,n)=>{const l=()=>{e.removeEventListener(t,n),e.removeEventListener("cleanup",l)};e.addEventListener(t,n),e.addEventListener("cleanup",l)},q=(e,t,n,l,o)=>{null!==e&&null!==t&&T(e,n,(()=>{t.firstElementChild.classList[l](o)}))},M=(e,t)=>{q(K(e),P(e),"mouseover","add",f),q(K(e),P(e),"mouseout","remove",f),q(P(e),K(e),"mouseover","add",t),q(P(e),K(e),"mouseout","remove",t)},R=e=>{E={},k={},b={},e.widgets.forEach(((e,t)=>{E[e.model.id]=e.node,k[e.model.id]=e.model,b[e.model.id]=t}))},W=e=>{e.widgets.forEach((e=>{e.node.classList.remove(a),e.node.classList.remove(u),e.node.classList.remove(r),e.node.classList.remove(m);const t=K(e.node);null!==t&&(t.firstElementChild.classList.remove(f),t.firstElementChild.classList.remove(h),t.dispatchEvent(v));const n=P(e.node);null!==n&&(n.firstElementChild.classList.remove(f),n.firstElementChild.classList.remove(h),n.dispatchEvent(v))}))},z=(e,t,n,l,o,d,c)=>{if(null===e)return;const s=()=>{for(const e of t){let t=h;c.has(e)&&(t=f);const o=l(n[e]);if(null===o||null===o.firstElementChild)return;o.firstElementChild.classList[d](t)}};e.addEventListener(o,s),T(e,o,s)},F=(e,t)=>{D(),g=t.activeCell,x=g.model.id;const n=e.session.kernel.createComm("ipyflow");let l=!1;const d=()=>{const e={};return t.widgets.forEach(((t,n)=>{e[t.model.id]={index:n,content:t.model.value.text,type:t.model.type}})),e},c=s().debounce((()=>{l?t.model.contentChanged.disconnect(c):n.send({type:"notify_content_changed",cell_metadata_by_id:d()})}),500),i=e=>{const t=d();n.send({type:"compute_exec_schedule",executed_cell_id:null==e?void 0:e.id,cell_metadata_by_id:t,is_reactively_executing:j})},v=(e,n)=>{l?e.stateChanged.disconnect(v):"executionCount"===n.name&&null!==n.newValue&&(t.widgets.forEach((t=>{t.model.id===e.id&&(t.node.classList.remove(r),t.node.classList.remove(m))})),i(e))},b=e=>{let l=-1;t.widgets.forEach(((t,n)=>{t.model.id===e.id&&(l=n)}));const o={type:"change_active_cell",active_cell_id:e.id,active_cell_order_idx:l};n.send(o)},I=(e,n)=>{if(t===e)if(l)t.activeCellChanged.disconnect(I);else if(b(n.model),null!==g&&null!==g.model&&(g.model.isDirty?y.add(x):y.delete(x),g.model.stateChanged.disconnect(v,g.model.stateChanged)),g=n,x=n.model.id,null!==g&&null!==g.model&&"code"===g.model.type){if(g.model.stateChanged.connect(v),b(g.model),y.has(x)){const e=g.model;void 0!==e._setDirty&&e._setDirty(!0)}R(t),q(x)}};t.activeCellChanged.connect(I);const T=[{action:"mouseover",update:"add"},{action:"mouseout",update:"remove"}],q=e=>{const t=k[e];if("code"!==t.type)return;if(null==t.executionCount)return;const n=E[e];C.has(e)?(n.classList.add(a),n.classList.add(r),n.classList.remove(m),M(n,f)):_.has(e)&&(n.classList.add(m),n.classList.add(r),M(n,h)),"reactive"!==S&&(Object.prototype.hasOwnProperty.call(p,e)&&T.forEach((({action:t,update:l})=>{z(K(n),p[e],E,K,t,l,C),z(P(n),p[e],E,K,t,l,C)})),Object.prototype.hasOwnProperty.call(w,e)&&(C.has(e)||(n.classList.add(u),n.classList.add(r)),T.forEach((({action:t,update:l})=>{z(K(n),w[e],E,K,t,l,C),z(K(n),w[e],E,P,t,l,C)}))))};return n.onMsg=d=>{var s,a;const r=d.content.data;if(!l&&null!==(s=r.success)&&void 0!==s&&s)if("establish"===r.type)t.activeCell.model.stateChanged.connect(v),b(t.activeCell.model),t.model.contentChanged.connect(c),i();else if("compute_exec_schedule"===r.type){C=new Set(r.waiting_cells),_=new Set(r.ready_cells),N=new Set([...N,...r.new_ready_cells]),B=new Set([...B,...r.forced_reactive_cells]),p=r.waiter_links,w=r.ready_maker_links,L=null;const l=r.exec_mode;j=j||"reactive"===l||null!==(a=null==r?void 0:r.is_reactively_executing)&&void 0!==a&&a;const d=r.flow_order,c=r.exec_schedule;S=l,O=r.highlights;const s=r.last_executed_cell_id;if(V.add(s),!r.last_execution_was_error){let e=!1;for(const n of t.widgets){if(!e&&(e=n.model.id===s,"in_order"===d||"strict"===c))continue;if("code"!==n.model.type||V.has(n.model.id))continue;if(!N.has(n.model.id))continue;if(!B.has(n.model.id)&&"reactive"!==l)continue;const t=n;if(null===L){if(L=t,"in_order"===d||"strict"===c)break}else null==t.model.executionCount||t.model.executionCount<L.model.executionCount&&(L=t)}}null===L?(j&&("reactive"===O&&(_=V),n.send({type:"reactivity_cleanup"})),B=new Set,N=new Set,V=new Set,(e=>{if(W(e),"none"!==O){R(e);for(const[e]of Object.entries(E))q(e)}})(t),j=!1,A=!1):(j=!0,I(t,L),o.CodeCell.execute(L,e))}},n.open({interface:"jupyterlab"}),()=>{l=!0,D()}},G=I}}]);