"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_discover_discoverQuery_tsx-app_views_starfish_components_chart_tsx-app_views_starfi-a0d6ab"],{"./app/components/charts/areaChart.tsx":(t,e,o)=>{o.d(e,{T:()=>n});var s=o("./app/components/charts/series/lineSeries.tsx"),a=o("./app/components/charts/baseChart.tsx"),r=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function n(t){let{series:e,stacked:o,colors:n,...i}=t;return(0,r.tZ)(a.Z,{...i,"data-test-id":"area-chart",colors:n,series:e.map(((t,e)=>{let{seriesName:a,data:r,...i}=t;return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.Z)({...t})}({stack:o?"area":void 0,name:a,data:r.map((t=>{let{name:e,value:o}=t;return[e,o]})),lineStyle:{color:n?.[e],opacity:1,width:.4},areaStyle:{color:n?.[e],opacity:1},animation:!1,animationThreshold:1,animationDuration:0,...i})}))})}n.displayName="AreaChart"},"./app/components/charts/chartZoom.tsx":(t,e,o)=>{o.d(e,{Z:()=>v});var s=o("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=(o("../node_modules/core-js/modules/es.array.push.js"),o("../node_modules/react/index.js")),r=o("../node_modules/moment/moment.js"),n=o.n(r),i=o("../node_modules/query-string/index.js"),d=o("./app/actionCreators/pageFilters.tsx"),l=o("./app/components/charts/components/dataZoomInside.tsx");o("../node_modules/echarts/lib/component/dataZoomSlider.js");const m={realtime:!1,showDetail:!1,left:0,right:6,bottom:8};function h(t){return t&&Array.isArray(t)?t:[{...m,...t}]}var c=o("./app/components/charts/components/toolBox.tsx"),u=o("./app/utils/callIfFunction.tsx"),p=o("./app/utils/dates.tsx");const x=t=>t?n().utc(t).format(n().HTML5_FMT.DATETIME_LOCAL_SECONDS):null;class f extends a.Component{constructor(t){var e;super(t),e=this,(0,s.Z)(this,"history",void 0),(0,s.Z)(this,"currentPeriod",void 0),(0,s.Z)(this,"zooming",null),(0,s.Z)(this,"saveCurrentPeriod",(t=>{this.currentPeriod={period:t.period,start:x(t.start),end:x(t.end)}})),(0,s.Z)(this,"setPeriod",(function(t){let{period:o,start:s,end:a}=t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{router:n,onZoom:l,usePageDate:m}=e.props,h=x(s),c=x(a);r&&e.history.push(e.currentPeriod),l?.({period:o,start:h,end:c}),e.zooming=()=>{if(m&&n){const t={...n.location.query,pageStart:s?(0,p.v5)(s):void 0,pageEnd:a?(0,p.v5)(a):void 0,pageStatsPeriod:o??void 0};i.stringify(t)!==i.stringify(n.location.query)&&n.push({pathname:n.location.pathname,query:t})}else(0,d.dR)({period:o,start:h?(0,p.hC)(h):h,end:c?(0,p.hC)(c):c},n,{skipDesyncUpdate:!0});e.saveCurrentPeriod({period:o,start:s,end:a})}})),(0,s.Z)(this,"handleChartReady",(t=>{this.props.onChartReady?.(t)})),(0,s.Z)(this,"handleZoomRestore",((t,e)=>{this.history.length&&(this.setPeriod(this.history[0]),this.history=[],this.props.onRestore?.(t,e))})),(0,s.Z)(this,"handleDataZoom",((t,e)=>{const o=e.getModel(),{startValue:s,endValue:a}=o._payload.batch[0];if(null===s&&null===a){const t=this.history.pop();if(!t)return;this.setPeriod(t)}else{const t=n().utc(s),e=n().utc(a);this.setPeriod({period:null,start:t,end:e},!0)}this.props.onDataZoom?.(t,e)})),(0,s.Z)(this,"handleChartFinished",((t,e)=>{"function"==typeof this.zooming&&(this.zooming(),this.zooming=null);const o=e._componentsViews?.find((t=>t._features&&t._features.dataZoom));o&&!o._features.dataZoom._isZoomActive&&e.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:!0}),(0,u.g)(this.props.onFinished)})),this.history=[],this.saveCurrentPeriod(t)}componentDidUpdate(){this.props.disabled||this.saveCurrentPeriod(this.props)}render(){const{utc:t,start:e,end:o,disabled:s,children:a,xAxisIndex:r,router:n,onZoom:i,onRestore:d,onChartReady:m,onDataZoom:u,onFinished:x,showSlider:f,chartZoomOptions:v,...y}=this.props,g=t??void 0,Z=e?(0,p.hC)(e):void 0,b=o?(0,p.hC)(o):void 0;return a(s?{utc:g,start:Z,end:b,...y}:{isGroupedByDate:!0,onChartReady:this.handleChartReady,utc:g,start:Z,end:b,dataZoom:f?[...h({xAxisIndex:r,...v}),...(0,l.Z)({xAxisIndex:r,...v})]:(0,l.Z)({xAxisIndex:r,...v}),showTimeInTooltip:!0,toolBox:(0,c.Z)({},{dataZoom:{title:{zoom:"",back:""},iconStyle:{borderWidth:0,color:"transparent",opacity:0}}}),onDataZoom:this.handleDataZoom,onFinished:this.handleChartFinished,onRestore:this.handleZoomRestore,...y})}}f.displayName="ChartZoom";const v=f},"./app/components/charts/components/dataZoomInside.tsx":(t,e,o)=>{o.d(e,{Z:()=>a}),o("../node_modules/echarts/lib/component/dataZoomInside.js");const s={type:"inside",zoomOnMouseWheel:!1,zoomLock:!0,throttle:50};function a(t){return t&&Array.isArray(t)?t:[{...s,...t}]}},"./app/components/charts/components/toolBox.tsx":(t,e,o)=>{function s(){let{dataZoom:t,...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...t?{dataZoom:{yAxisIndex:"none",title:{zoom:"zoom",back:"undo"},...t}}:{},...e}}function a(t,e){return{right:0,top:0,itemSize:16,z:-1,feature:s(e),...t}}o.d(e,{Z:()=>a})},"./app/utils/discover/discoverQuery.tsx":(t,e,o)=>{o.d(e,{Z:()=>d,_:()=>i});var s=o("./app/utils/discover/genericDiscoverQuery.tsx"),a=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function r(t,e){return t.transactionName!==e.transactionName||t.transactionThreshold!==e.transactionThreshold||t.transactionThresholdMetric!==e.transactionThresholdMetric}function n(t){return(0,a.tZ)(s.ZP,{route:"events",shouldRefetchData:r,afterFetch:(t,e)=>{const{fields:o,...s}=t.meta??{};return{...t,meta:{...o,...s}}},...t})}function i(t){return(0,s.JC)({route:"events",shouldRefetchData:r,afterFetch:(t,e)=>{const{fields:o,...s}=t.meta??{};return{...t,meta:{...o,...s}}},...t})}n.displayName="DiscoverQuery";const d=n},"./app/views/starfish/components/chart.tsx":(t,e,o)=>{o.d(e,{Z:()=>_}),o("../node_modules/core-js/modules/es.array.push.js");var s=o("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),a=o("../node_modules/lodash/max.js"),r=o.n(a),n=o("../node_modules/lodash/min.js"),i=o.n(n),d=o("./app/components/charts/areaChart.tsx"),l=o("./app/components/charts/barChart.tsx"),m=o("./app/components/charts/baseChart.tsx"),h=o("./app/components/charts/chartZoom.tsx"),c=o("./app/components/charts/lineChart.tsx"),u=o("./app/components/charts/series/lineSeries.tsx"),p=(o("../node_modules/echarts/lib/chart/scatter.js"),o("./app/utils/theme.tsx"));function x(t){return{symbolSize:p.ZP.charts.symbolSize,...t,type:"scatter",emphasis:{...t.emphasis,scale:!0}}}var f=o("./app/utils/discover/charts.tsx"),v=o("./app/utils/discover/fields.tsx"),y=o("./app/utils/useRouter.tsx"),g=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function Z(t){const e=t.map((t=>t.data.map((t=>t.value))));return r()(e.map(r()))}function b(t){let{data:e,previousData:o,statsPeriod:a,start:n,end:p,utc:b,loading:_,height:C,grid:w,disableXAxis:j,definedAxisTicks:A,chartColors:P,isBarChart:D,isLineChart:S,stacked:T,log:I,hideYAxisSplitLine:z,showLegend:M,scatterPlot:N,throughput:k}=t;const L=(0,y.Z)(),R=(0,s.u)();if(!e||e.length<=0)return null;const F=P??R.charts.getColorPalette(4),Y=e.every((t=>"duration"===(0,v.Px)(t.seriesName))),B=e.every((t=>"percentage"===(0,v.Px)(t.seriesName)));let O=Y?function(t){let e=0;if(t.length>2)for(let o=0;o<t.length;o++)e+=r()(t[o].data.map((t=>t.value)));else e=Z(t);if(e<=1)return 1;const o=Math.log10(e),s=i()([r()([10**(o-Math.floor(o)),0]),10]);let a;a=s<=2.5?.2:s<=5?.5:s<=7.5?1:2;const n=10**Math.floor(o)*a;return Math.round(Math.ceil(e/n)*n)}([...e,...N??[]]):B?Z(e):void 0;1===O&&Y&&(O+=1);const q=(0,f.Xp)(e);let E;const Q=[];k&&k.length>1&&(E=[(0,u.Z)({name:"Throughput",data:k.map((t=>{let{interval:e,count:o}=t;return[e,o]})),yAxisIndex:1,lineStyle:{type:"dashed",width:1,opacity:.5},animation:!1,animationThreshold:1,animationDuration:0})],Q.push({minInterval:q,splitNumber:A,max:O,type:"value",axisLabel:{color:R.chartLabel,formatter:t=>(0,f.gu)(t,"number",!0)},splitLine:z?{show:!1}:void 0}));const G=[{minInterval:q,splitNumber:A,max:O,type:I?"log":"value",axisLabel:{color:R.chartLabel,formatter:t=>(0,f.gu)(t,(0,v.Px)(e[0].seriesName),void 0,q)},splitLine:z?{show:!1}:void 0},...Q],H={seriesOptions:{showSymbol:!1},grid:w,yAxes:G,utc:b,legend:M?{top:0,right:10}:void 0,isGroupedByDate:!0,showTimeInTooltip:!0,colors:F,tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{show:!1}},valueFormatter:(t,o)=>(0,f.CX)(t,(0,v.Px)(e&&e.length?e[0].seriesName:o)),nameFormatter:t=>"epm()"===t?"tpm()":t}};if(_)return S?(0,g.tZ)(c.w,{height:C,series:[],...H}):D?(0,g.tZ)(l.v,{height:C,series:[],...H}):(0,g.tZ)(d.T,{height:C,series:[],...H});const V=e.map(((t,e)=>({...t,yAxisIndex:0,xAxisIndex:0}))),W=j?{show:!1,axisLabel:{show:!0,margin:0},axisLine:{show:!1}}:void 0;return(0,g.tZ)(h.Z,{router:L,period:a,start:n,end:p,utc:b,children:t=>S?(0,g.tZ)(m.Z,{...t,height:C,previousPeriod:o,additionalSeries:E,xAxis:W,yAxes:H.yAxes,tooltip:H.tooltip,colors:F,grid:w,legend:M?{top:0,right:0}:void 0,series:[...V.map((t=>{let{seriesName:e,data:o,...s}=t;return(0,u.Z)({...s,name:e,data:o?.map((t=>{let{value:e,name:o}=t;return[o,e]})),animation:!1,animationThreshold:1,animationDuration:0})})),...(N??[]).map((t=>{let{seriesName:e,data:o,...s}=t;return x({...s,name:e,data:o?.map((t=>{let{value:e,name:o}=t;return[o,e]})),animation:!1})}))]}):D?(0,g.tZ)(l.v,{height:C,series:V,xAxis:W,additionalSeries:E,yAxes:H.yAxes,tooltip:H.tooltip,colors:F,grid:w,legend:M?{top:0,right:0}:void 0}):(0,g.tZ)(d.T,{height:C,...t,series:V,previousPeriod:o,additionalSeries:E,xAxis:W,stacked:T,...H})})}b.displayName="Chart";const _=b},"./app/views/starfish/utils/dates.tsx":(t,e,o)=>{o.d(e,{Pr:()=>d,SW:()=>m,ie:()=>i,tZ:()=>h}),o("../node_modules/core-js/modules/es.error.cause.js");var s=o("../node_modules/moment/moment.js"),a=o.n(s),r=o("./app/utils/dates.tsx");function n(t,e){const o=a()(e).diff(a()(t)),s=a()(t).add(o/2);return(0,r.v5)(s)}function i(t){let{start:e,end:o,statsPeriod:s}=t;if(s)return n((0,r.Yz)("hours",(0,r.YJ)(s)).toDate(),new Date);if(!e||!o)throw new Error("start and end required");return n(e,o)}const d=/^(\d+)([h,d])$/,l="YYYY-MM-DD HH:mm:ss",m=t=>{if(!t)return{};const[e,o,s]=t.period?.match(d)??[];return{start_timestamp:(t.start&&a()(t.start).format(l))??(o&&s&&a()().subtract(o,s).format(l)),end_timestamp:t.end&&a()(t.end).format(l)}};function h(t){const[e,o,s]=t.selection.datetime.period?.match(d)??[];return{startTime:o&&s?a()().subtract(o,s):a()(t.selection.datetime.start),endTime:a()(t.selection.datetime.end??void 0)}}},"./app/views/starfish/utils/zeroFillSeries.tsx":(t,e,o)=>{o.d(e,{b:()=>r}),o("../node_modules/core-js/modules/es.array.push.js");var s=o("../node_modules/moment/moment.js"),a=o.n(s);function r(t,e,o,s,r){if(!t?.data?.length)return t;r||(r=0);const i=t.data[0],d=t.data[t.data.length-1],l=a()(i.name).creationData().format?.toString();if(!l)return t;const m=[],h=o&&n(o.clone().add(12,"hour").subtract(1,"ms")),c=s&&n(s),u=[...h&&h.diff(a()(i.name))<0?[{value:r,name:h.format(l)}]:[],...t.data,...c&&c.diff(a()(d.name))>0?[{value:r,name:c.format(l)}]:[]];let p,x,f,v,y;for(let t=0;t<u.length-1;t++){for(0===t&&m.push({...u[t],name:a()(u[t].name).format(l)}),p=u[t],x=u[t+1],f=a()(p.name),v=a()(x.name),y=a().duration(v.diff(f));y.asMilliseconds()>e.asMilliseconds();)f.add(e),m.push({value:r,name:a()(f).format(l)}),y=a().duration(a()(x.name).diff(f));m.push({...x,name:a()(x.name).format(l)})}return{...t,data:m}}function n(t){const e=t.hour(),o=t.clone().startOf("day");return e<12?o:o.add(12,"hour")}}}]);
//# sourceMappingURL=../sourcemaps/app_utils_discover_discoverQuery_tsx-app_views_starfish_components_chart_tsx-app_views_starfi-a0d6ab.e2362a8bada9d723e73a74cef9f139ca.js.map