"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_modules_APIModule_index_tsx"],{"./app/utils/useKeyPress.tsx":(e,t,i)=>{i.d(t,{Z:()=>n});var s=i("../node_modules/react/index.js");const n=(e,t)=>{const[i,n]=(0,s.useState)(!1),a=t??document.body;return(0,s.useEffect)((()=>{const t=t=>{let{key:i}=t;i===e&&n(!0)},i=t=>{let{key:i}=t;i===e&&n(!1)};return a.addEventListener("keydown",t),a.addEventListener("keyup",i),()=>{a.removeEventListener("keydown",t),a.removeEventListener("keyup",i)}}),[e,a]),i}},"./app/utils/useOnClickOutside.tsx":(e,t,i)=>{i.d(t,{Z:()=>n});var s=i("../node_modules/react/index.js");const n=function(e,t){(0,s.useEffect)((()=>{const i=i=>{const s=e?.current;s&&!s.contains(i.target)&&t(i)};return document.addEventListener("mousedown",i),document.addEventListener("touchstart",i),()=>{document.removeEventListener("mousedown",i),document.removeEventListener("touchstart",i)}}),[e,t])}},"./app/views/starfish/components/detailPanel.tsx":(e,t,i)=>{i.d(t,{Z:()=>x});var s=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=i("../node_modules/react/index.js"),a=i("./app/components/button.tsx"),o=i("./app/icons/iconClose.tsx"),r=i("./app/locale.tsx"),l=i("./app/styles/space.tsx"),d=i("./app/utils/useKeyPress.tsx"),c=i("./app/utils/useOnClickOutside.tsx"),p=i("../node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js"),u=i("../node_modules/framer-motion/dist/es/render/dom/motion.mjs"),m=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const h="50vw",f=(0,n.forwardRef)(g);function g(e,t){let{collapsed:i,children:s}=e;return(0,m.tZ)(Z,{ref:t,collapsed:i,initial:{opacity:0,x:h},animate:i?{opacity:0,x:h}:{opacity:1,x:0},transition:{type:"spring",stiffness:500,damping:50},children:s})}g.displayName="SlideOverPanel";const Z=(0,s.Z)(u.E.div,{shouldForwardProp:e=>["animate","transition"].includes(e)||"collapsed"!==e&&(0,p.Z)(e),target:"e1iwvxg00"})("width:",h,";position:fixed;top:0;bottom:0;right:0;background:",(e=>e.theme.background),";color:",(e=>e.theme.textColor),";border-left:1px solid ",(e=>e.theme.border),";text-align:left;z-index:",(e=>e.theme.zIndex.sidebar-1),";",(e=>e.collapsed?"overflow: hidden;":"overflow-x: hidden;\n  overflow-y: scroll;"),";");function x(e){let{children:t,detailKey:i,onClose:s}=e;const[a,l]=(0,n.useState)({collapsed:!0}),p=(0,d.Z)("Escape");(0,n.useEffect)((()=>{i&&l({collapsed:!1})}),[i]);const u=(0,n.useRef)(null);return(0,c.Z)(u,(()=>{a.collapsed||(s?.(),l({collapsed:!0}))})),(0,n.useEffect)((()=>{p&&(a.collapsed||(s?.(),l({collapsed:!0})))}),[p]),(0,m.BX)(f,{collapsed:a.collapsed,ref:u,children:[(0,m.tZ)(y,{children:(0,m.tZ)(v,{priority:"link",size:"zero",borderless:!0,"aria-label":(0,r.t)("Close Details"),icon:(0,m.tZ)(o.b,{size:"sm"}),onClick:()=>{l({collapsed:!0}),s?.()}})}),(0,m.tZ)(b,{children:t})]})}x.displayName="Detail";const v=(0,s.Z)(a.zx,{target:"e1clb2dw2"})("color:",(e=>e.theme.gray300),";&:hover{color:",(e=>e.theme.gray400),";}"),y=(0,s.Z)("div",{target:"e1clb2dw1"})("justify-content:flex-end;display:flex;padding:",(0,l.D)(2),";"),b=(0,s.Z)("div",{target:"e1clb2dw0"})("padding:0 ",(0,l.D)(4),";")},"./app/views/starfish/modules/APIModule/index.tsx":(e,t,i)=>{i.r(t),i.d(t,{default:()=>U});var s=i("../node_modules/react/index.js"),n=i("./app/components/layouts/thirds.tsx"),a=i("./app/locale.tsx"),o=i("./app/utils/performance/contexts/pageError.tsx"),r=i("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),l=(i("../node_modules/core-js/modules/es.array.push.js"),i("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js")),d=i("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),c=i("../node_modules/moment/moment.js"),p=i.n(c),u=i("../node_modules/query-string/index.js"),m=i("./app/components/duration.tsx"),h=i("./app/components/gridEditable/index.tsx"),f=i("./app/components/links/link.tsx"),g=i("./app/styles/space.tsx"),Z=i("./app/utils/useLocation.tsx"),x=i("./app/utils/usePageFilters.tsx"),v=i("./app/views/starfish/components/chart.tsx"),y=i("./app/views/starfish/components/detailPanel.tsx"),b=i("./app/views/starfish/modules/APIModule/endpointTable.tsx"),w=i("./app/views/starfish/modules/APIModule/queries.tsx"),_=i("./app/views/starfish/utils/constants.tsx"),P=i("./app/views/starfish/utils/dates.tsx"),k=i("./app/views/starfish/utils/useSpansQuery.tsx"),D=i("./app/views/starfish/utils/zeroFillSeries.tsx"),j=i("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const E=[{key:"transaction",name:"Transaction",width:280},{key:"count()",name:"Count",width:h.z7},{key:"p50(span.self_time)",name:"p50",width:h.z7},{key:"failure_rate",name:"Error %",width:h.z7}];function C(e){let{row:t,onClose:i}=e;return(0,j.tZ)(y.Z,{detailKey:t?.description,onClose:i,children:t&&(0,j.tZ)(L,{row:t})})}function L(e){let{row:t}=e;const i=(0,x.Z)(),s=(0,Z.T)(),n=(0,w.Zn)({description:null,transactionName:null,datetime:i.selection.datetime,groupId:t.group_id}),{isLoading:o,data:r}=(0,d.a)({queryKey:[n],queryFn:()=>fetch(`${_.M}/?query=${n}`).then((e=>e.json())),retry:!1,initialData:[]}),{isLoading:l,data:c}=(0,k.bB)({queryString:(0,w.o_)({description:null,transactionName:null,datetime:i.selection.datetime,groupId:t.group_id}),eventView:(0,w.J5)({description:null,transactionName:null,datetime:i.selection.datetime,groupId:t.group_id}),initialData:[]}),[u,f,g]=i.selection.datetime.period?.match(P.Pr)??[],v=f&&g?p()().subtract(f,g):p()(i.selection.datetime.start),y=p()(i.selection.datetime.end??void 0),[C,L,I,N,X]=function(e){const t=[];return e.length>0&&Object.keys(e[0]).filter((e=>"interval"!==e)).forEach((e=>{t.push({seriesName:`${e}()`,data:[]})})),e.forEach((e=>{Object.keys(e).forEach((i=>{"interval"!==i&&t.find((e=>e.seriesName===`${i}()`))?.data.push({name:e.interval,value:e[i]})}))})),t}(r).map((e=>(0,D.b)(e,p().duration(12,"hours"),v,y)));return(0,j.BX)("div",{children:[(0,j.tZ)("h2",{children:(0,a.t)("Endpoint Detail")}),(0,j.tZ)("p",{children:(0,a.t)("Detailed summary of http client spans. Detailed summary of http client spans. Detailed summary of http client spans. Detailed summary of http client spans. Detailed summary of http client spans. Detailed summary of http client spans.")}),(0,j.tZ)(z,{children:(0,a.t)("Endpoint URL")}),(0,j.tZ)("pre",{children:t?.description}),(0,j.tZ)(z,{children:(0,a.t)("Domain")}),(0,j.tZ)("pre",{children:t?.domain}),(0,j.BX)(O,{children:[(0,j.BX)(T,{children:[(0,j.tZ)(z,{children:(0,a.t)("Duration (P50)")}),(0,j.tZ)(A,{children:(0,j.tZ)(m.Z,{seconds:t["p50(span.self_time)"]/1e3,fixedDigits:2,abbreviation:!0})}),(0,j.tZ)(B,{series:C,isLoading:o,index:2,outOf:4})]}),(0,j.BX)(T,{children:[(0,j.tZ)(z,{children:(0,a.t)("Duration (P95)")}),(0,j.tZ)(A,{children:(0,j.tZ)(m.Z,{seconds:t["p95(span.self_time)"]/1e3,fixedDigits:2,abbreviation:!0})}),(0,j.tZ)(B,{series:L,isLoading:o,index:3,outOf:4})]}),(0,j.BX)(T,{children:[(0,j.tZ)(z,{children:(0,a.t)("Throughput")}),(0,j.tZ)(A,{children:t.count}),(0,j.tZ)(B,{series:I,isLoading:o,index:0,outOf:4})]}),(0,j.BX)(T,{children:[(0,j.tZ)(z,{children:(0,a.t)("Error Rate")}),(0,j.tZ)(A,{children:t.failure_rate}),(0,j.tZ)(B,{series:X,isLoading:o,index:1,outOf:4})]})]}),(0,j.tZ)(h.ZP,{isLoading:l,data:c,columnOrder:E,columnSortBy:[],grid:{renderHeadCell:b.WJ,renderBodyCell:(e,i)=>S(e,i,t.group_id)},location:s})]})}function S(e,t,i){return"transaction"===e.key?(0,j.tZ)(b._F,{children:(0,j.tZ)(f.Z,{to:`/starfish/span/${i}?${u.stringify({transaction:t.transaction})}`,children:t[e.key]})}):e.key.toString().match(/^p\d\d/)?(0,j.tZ)(b.xe,{children:(0,j.tZ)(m.Z,{seconds:t[e.key]/1e3,fixedDigits:2,abbreviation:!0})}):["description","transaction"].includes(e.key.toString())?(0,j.tZ)(b._F,{children:t[e.key]}):(0,j.tZ)(b.xe,{children:(0,j.tZ)(b._F,{children:t[e.key]})})}function B(e){const t=(0,l.u)();return(0,j.tZ)(v.Z,{statsPeriod:"24h",height:110,data:e.series?[e.series]:[],start:"",end:"",loading:e.isLoading,utc:!1,stacked:!0,isLineChart:!0,disableXAxis:!0,hideYAxisSplitLine:!0,chartColors:[t.charts.getColorPalette(e.outOf-2)[e.index]],grid:{left:"0",right:"0",top:"8px",bottom:"16px"}})}C.displayName="EndpointDetail",L.displayName="EndpointDetailBody",S.displayName="renderBodyCell",B.displayName="APIDetailChart";const z=(0,r.Z)("h3",{target:"e13j220b3"})("color:",(e=>e.theme.gray300),";font-size:",(e=>e.theme.fontSizeMedium),";margin:0;margin-bottom:",(0,g.D)(1),";"),A=(0,r.Z)("h4",{target:"e13j220b2"})({name:"3in70x",styles:"margin:0;font-weight:normal"}),O=(0,r.Z)("div",{target:"e13j220b1"})("display:flex;&>div:last-child{padding-right:",(0,g.D)(1),";}flex-wrap:wrap;"),T=(0,r.Z)("div",{target:"e13j220b0"})("padding-right:",(0,g.D)(4),";flex:1;flex-grow:0;min-width:280px;&>h3{margin-bottom:0;}");var I=i("./app/components/compactSelect/index.tsx"),N=i("./app/components/datePageFilter.tsx"),X=i("./app/components/organizations/pageFilters/parse.tsx"),F=i("./app/utils/queryClient.tsx"),q=i("./app/utils/useOrganization.tsx"),M=i("./app/views/starfish/components/chartPanel.tsx"),R=i("./app/views/starfish/modules/APIModule/hostDetails.tsx"),K=i("./app/views/starfish/modules/APIModule/hostTable.tsx");const $=[{value:"",label:"All"},...["GET","POST","PUT","DELETE"].map((e=>({value:e,label:e})))];function V(e){let{location:t,onSelect:i}=e;const n=(0,l.u)(),o=(0,x.Z)(),[r,d]=(0,s.useState)({action:"",domain:"",transaction:""}),c=(0,s.useRef)(null),u=(0,q.Z)(),m=(0,w.Ao)({datetime:o.selection.datetime}),h=(0,w.S4)({datetime:o.selection.datetime}),{selection:f}=o,{projects:g,environments:Z,datetime:v}=f;(0,F.WE)([`/organizations/${u.slug}/events-starfish/`,{query:{environment:Z,project:g.map((e=>String(e))),...(0,X.fK)(v)}}],{staleTime:10});const{isLoading:y,data:_}=(0,k.bB)({eventView:m,queryString:h,initialData:[]}),E=(0,w.xI)({datetime:o.selection.datetime}),{isLoading:C,data:L}=(0,k.bB)({eventView:E,queryString:(0,w.YK)({datetime:o.selection.datetime}),initialData:[]}),S=["p50(span.self_time)","p75(span.self_time)","p95(span.self_time)","p99(span.self_time)"],B={};S.forEach((e=>{B[e]={seriesName:e,data:[]}}));const z={seriesName:"count",data:[]},A={seriesName:"failure_rate",data:[]};L.forEach((e=>{S.forEach((t=>{B[t].data.push({value:e[t],name:e.interval})})),z.data.push({value:e["count()"],name:e.interval}),A.data.push({value:e["failure_rate()"],name:e.interval})}));const[O,T,V]=o.selection.datetime.period?.match(P.Pr)??[],U=T&&V?p()().subtract(T,V):p()(o.selection.datetime.start),G=p()(o.selection.datetime.end??void 0),[H,ee,te]=[B,[z],[A]].map((e=>Object.values(e).map((e=>(0,D.b)(e,p().duration(12,"hours"),U,G))))),ie=e=>{d({...r,domain:e})},se=[{value:"",label:"All"},..._.filter((e=>{let{domain:t}=e;return""!==t})).map((e=>{let{domain:t}=e;return{value:t,label:t}}))];return(0,j.BX)(s.Fragment,{children:[(0,j.BX)(Q,{children:[(0,j.tZ)(I.Z,{triggerProps:{prefix:(0,a.t)("Service")},value:"project",options:[{value:"project",label:"Project"}],onChange:()=>{}}),(0,j.tZ)(N.Z,{alignDropdown:"left"})]}),(0,j.BX)(W,{children:[(0,j.tZ)(J,{children:(0,j.tZ)(M.Z,{title:(0,a.t)("Throughput"),children:(0,j.tZ)(Y,{data:ee,loading:C})})}),(0,j.tZ)(J,{children:(0,j.tZ)(M.Z,{title:(0,a.t)("Response Time"),children:(0,j.tZ)(Y,{data:H,loading:C})})}),(0,j.tZ)(J,{children:(0,j.tZ)(M.Z,{title:(0,a.t)("Error Rate"),children:(0,j.tZ)(Y,{data:te,loading:C,chartColors:[n.charts.getColorPalette(2)[2]]})})})]}),(0,j.tZ)(K.Z,{location:t,setDomainFilter:e=>{ie(e),setTimeout((()=>{c.current?.scrollIntoView({behavior:"smooth",inline:"start"})}),200)}}),(0,j.BX)(Q,{children:[(0,j.tZ)(I.Z,{triggerProps:{prefix:(0,a.t)("Operation")},value:r.action,options:$,onChange:e=>{let{value:t}=e;return i=t,void d({...r,action:i});var i}}),(0,j.tZ)(I.Z,{triggerProps:{prefix:(0,a.t)("Domain")},value:r.domain,options:se,onChange:e=>{let{value:t}=e;return ie(t)}})]}),(0,j.BX)("div",{ref:c,children:[r.domain&&(0,j.tZ)(R.F,{host:r.domain}),(0,j.tZ)(b.ZP,{location:t,onSelect:i,filterOptions:{...r,datetime:o.selection.datetime}})]})]})}function Y(e){let{data:t,loading:i,chartColors:s}=e;const n=(0,l.u)();return(0,j.tZ)(v.Z,{statsPeriod:"24h",height:140,data:t,start:"",end:"",loading:i,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,stacked:!0,isLineChart:!0,chartColors:s??n.charts.getColorPalette(2),disableXAxis:!0})}V.displayName="APIModuleView",Y.displayName="APIModuleChart";const W=(0,r.Z)("div",{target:"ercz3dc2"})("display:flex;flex-direction:row;flex-wrap:wrap;gap:",(0,g.D)(2),";"),J=(0,r.Z)("div",{target:"ercz3dc1"})({name:"82a6rk",styles:"flex:1"}),Q=(0,r.Z)("div",{target:"ercz3dc0"})("display:flex;flex-direction:row;gap:",(0,g.D)(1),";margin-bottom:",(0,g.D)(2),";");function U(e){const[t,i]=(0,s.useState)({selectedRow:void 0}),{selectedRow:r}=t;return(0,j.tZ)(n.T3,{children:(0,j.BX)(o.V_,{children:[(0,j.tZ)(n.h4,{children:(0,j.tZ)(n.oB,{children:(0,j.tZ)(n.Dx,{children:(0,a.t)("API")})})}),(0,j.tZ)(n.uT,{children:(0,j.BX)(n.or,{fullWidth:!0,children:[(0,j.tZ)(o.YY,{}),(0,j.tZ)(V,{...e,onSelect:e=>i({selectedRow:e})}),(0,j.tZ)(C,{row:r,onClose:()=>i({selectedRow:void 0})})]})})]})})}U.displayName="APIModule"}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_modules_APIModule_index_tsx.f77335379d10ade2edf021e418060a61.js.map