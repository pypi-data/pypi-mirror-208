"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_actionCreators_events_tsx-app_components_group_tagFacets_index_tsx"],{"./app/actionCreators/events.tsx":(e,t,r)=>{r.d(t,{A5:()=>x,JE:()=>h,MD:()=>v,eV:()=>m,lI:()=>g});var s=r("../node_modules/lodash/pick.js"),n=r.n(s),o=r("./app/actionCreators/indicator.tsx"),i=r("./app/components/charts/utils.tsx"),a=r("./app/locale.tsx"),l=r("./app/utils/getPeriod.tsx"),u=r("./app/utils/performance/constants.tsx"),c=r("./app/utils/queryClient.tsx"),d=r("./app/utils/useApi.tsx"),p=r("./app/utils/useOrganization.tsx");const g=(e,t)=>{let{organization:r,project:s,environment:n,team:o,period:a,start:u,end:c,interval:d,comparisonDelta:p,includePrevious:g,query:m,yAxis:h,field:f,topEvents:v,orderby:x,partial:b,withoutZerofill:y,referrer:Z,queryBatching:w,generatePathname:_,queryExtras:D,excludeOther:k,includeAllArgs:j,dataset:E}=t;const S=_?.(r)??`/organizations/${r.slug}/events-stats/`,z=(0,i.Sw)(g,a),O={includeAllArgs:j,query:{...Object.fromEntries(Object.entries({interval:d,comparisonDelta:p,project:s,environment:n,team:o,query:m,yAxis:h,field:f,topEvents:v,orderby:x,partial:b?"1":void 0,withoutZerofill:y?"1":void 0,referrer:Z||"api.organization-event-stats",excludeOther:k?"1":void 0,dataset:E}).filter((e=>{let[,t]=e;return void 0!==t}))),...(0,l.X)({period:a,start:u,end:c},{shouldDoublePeriod:z}),...D}};return w?.batchRequest?w.batchRequest(e,S,O):e.requestPromise(S,O)};function m(e,t,r){const s={...n()(r,Object.values(u.s)),query:r.query};return e.requestPromise(`/organizations/${t}/events-facets/`,{query:s})}function h(e,t,r){const s={...n()(r,Object.values(u.s)),query:r.query};return e.requestPromise(`/organizations/${t}/events-meta/`,{query:s}).then((e=>e.count))}const f=e=>{let{orgSlug:t,projectSlug:r,eventId:s}=e;return[`/projects/${t}/${r}/events/${s}/attachments/`]},v=function(e){let{orgSlug:t,projectSlug:r,eventId:s}=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=(0,p.Z)();return(0,c.WE)([`/projects/${t}/${r}/events/${s}/attachments/`],{staleTime:1/0,...n,enabled:(o.features?.includes("event-attachments")??!1)&&!1!==n.enabled})},x=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=(0,d.Z)({persistInFlight:!0}),r=(0,c.NL)(),s={...e,mutationFn:e=>{let{orgSlug:r,projectSlug:s,eventId:n,attachmentId:o}=e;return t.requestPromise(`/projects/${r}/${s}/events/${n}/attachments/${o}/`,{method:"DELETE"})},onMutate:async t=>{await r.cancelQueries(f(t));const s=(0,c.nE)(r,f(t));return(0,c.XN)(r,f(t),(e=>Array.isArray(e)?e.filter((e=>e?.id!==t.attachmentId)):e)),e.onMutate?.(t),{previous:s}},onError:(t,s,n)=>{(0,o.Iw)((0,a.t)("An error occurred while deleting the attachment")),n&&(0,c.XN)(r,f(s),n.previous),e.onError?.(t,s,n)}};return(0,c.Db)(s)}},"./app/components/group/tagFacets/index.tsx":(e,t,r)=>{r.d(t,{$c:()=>Z,Ix:()=>k,Pf:()=>_,Rj:()=>w,V6:()=>D,WN:()=>A,ZP:()=>j});var s=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=r("../node_modules/react/index.js"),o=r("../node_modules/lodash/keyBy.js"),i=r.n(o),a=r("./app/components/loadingError.tsx"),l=r("./app/components/placeholder.tsx"),u=r("./app/components/sidebarSection.tsx"),c=r("./app/components/tooltip.tsx"),d=r("./app/icons/index.tsx"),p=r("./app/locale.tsx"),g=r("./app/styles/space.tsx"),m=r("./app/utils/formatters.tsx"),h=r("./app/utils/queryString.tsx"),f=r("./app/utils/useLocation.tsx"),v=r("./app/utils/useOrganization.tsx"),x=r("./app/views/issueDetails/utils.tsx"),b=r("./app/components/group/tagFacets/tagFacetsDistributionMeter.tsx"),y=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const Z=["device","device.class","os","release","environment","transaction"],w=["browser","transaction","release","url","environment"],_=["transaction","url","user","release","organization.slug"],D=["transaction","environment","release"];function k(e){const t={};return Object.keys(e).forEach((r=>{t[r]="release"===r?{...e[r],topValues:e[r].topValues.map((e=>({...e,name:(0,m.ko)(e.name)})))}:"device"===r?{...e[r],topValues:e[r].topValues.map((e=>({...e,name:e.readable??e.name})))}:e[r]})),t}function j(e){let{tagKeys:t,environments:r,groupId:s,tagFormatter:o,project:u}=e;const c=(0,v.Z)(),{isLoading:d,isError:g,data:m,refetch:h}=(0,x.by)({groupId:s,environment:r.map((e=>{let{name:t}=e;return t}))}),f=(0,n.useMemo)((()=>{if(!m)return{};const e=i()(m,"key"),t=o?.(e)??e;return c.features.includes("device-classification")||delete t["device.class"],t}),[m,o,c]),b=t.filter((e=>Object.keys(f).includes(e))),Z=Object.keys(f).filter((e=>!t.includes(e))).sort();return d?(0,y.tZ)(E,{children:(0,y.BX)(z,{children:[(0,y.tZ)(l.Z,{height:"40px"}),(0,y.tZ)(l.Z,{height:"40px"}),(0,y.tZ)(l.Z,{height:"40px"}),(0,y.tZ)(l.Z,{height:"40px"})]})}):g?(0,y.tZ)(E,{children:(0,y.tZ)(a.Z,{message:(0,p.t)("There was an error loading tags for this issue."),onRetry:h})}):(0,y.tZ)(E,{children:(0,y.tZ)(n.Fragment,{children:0===Object.keys(f).length?(0,y.tZ)(q,{"data-test-id":"no-tags",children:r.length?(0,p.t)("No tags found in the selected environments"):(0,p.t)("No tags found")}):(0,y.BX)(O,{children:[(0,y.tZ)("span",{"data-test-id":"top-distribution-wrapper",children:(0,y.tZ)(S,{groupId:s,organization:c,project:u,tagKeys:b,tagsData:f,expandFirstTag:!0})}),(0,y.tZ)(S,{groupId:s,organization:c,project:u,tagKeys:Z,tagsData:f})]})})})}function E(e){let{children:t}=e;return(0,y.BX)(u.Eq,{children:[(0,y.BX)(u.Dx,{children:[(0,p.t)("All Tags"),(0,y.tZ)($,{children:(0,y.tZ)(c.u,{title:(0,p.t)("The tags associated with all events in this issue"),disableForVisualTest:!0,children:(0,y.tZ)(d.BS,{size:"sm",color:"gray200"})})})]}),t]})}function S(e){let{groupId:t,organization:r,project:s,tagKeys:n,tagsData:o,expandFirstTag:i}=e;const a=(0,f.T)(),l={...a.query};return(0,y.tZ)(A,{children:n.map(((e,n)=>{const u=o[e],c=u?u.topValues:[],d=u?u.totalValues:0,p=`/organizations/${r.slug}/issues/${t}/tags/${e}/?referrer=tag-distribution-meter`,g=`/organizations/${r.slug}/issues/${t}/events/`,m=c?c.map((t=>{const r={...a,query:{...l,query:(0,h.os)(null,e,t.value)},pathname:g};return{...t,url:r}})):[];return(0,y.tZ)("li",{"aria-label":e,children:(0,y.tZ)(b.Z,{title:e,totalValues:d,segments:m,onTagClick:()=>{},project:s,expandByDefault:i&&0===n,otherUrl:p})},e)}))})}j.displayName="TagFacets",E.displayName="WrapperWithTitle",S.displayName="TagFacetsDistributionMeterWrapper";const z=(0,s.Z)("div",{target:"e1dti8s94"})("display:grid;gap:",(0,g.D)(1),";grid-auto-flow:row;margin-top:",(0,g.D)(1),";"),O=(0,s.Z)("div",{target:"e1dti8s93"})("margin-top:",(0,g.D)(2),";"),q=(0,s.Z)("p",{target:"e1dti8s92"})("margin-top:",(0,g.D)(.5),";"),A=(0,s.Z)("ol",{target:"e1dti8s91"})("list-style:none;padding:0;margin:0 0 ",(0,g.D)(2),";"),$=(0,s.Z)("span",{target:"e1dti8s90"})("vertical-align:middle;padding-left:",(0,g.D)(.5),";")},"./app/components/group/tagFacets/tagFacetsDistributionMeter.tsx":(e,t,r)=>{r.d(t,{Z:()=>k});var s=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(r("../node_modules/core-js/modules/es.array.push.js"),r("../node_modules/react/index.js")),o=r("../node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js"),i=r("../node_modules/framer-motion/dist/es/render/dom/motion.mjs"),a=r("../node_modules/lodash/debounce.js"),l=r.n(a),u=r("./app/components/button.tsx"),c=r("./app/components/links/link.tsx"),d=r("./app/components/tooltip.tsx"),p=r("./app/icons/iconChevron.tsx"),g=r("./app/locale.tsx"),m=r("./app/styles/space.tsx"),h=r("./app/utils.tsx"),f=r("./app/utils/analytics.tsx"),v=r("./app/utils/platform.tsx"),x=r("./app/utils/queryString.tsx"),b=r("./app/utils/useLocation.tsx"),y=r("./app/utils/useOrganization.tsx"),Z=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const w=["#402A65","#694D99","#9A81C4","#BBA6DF","#EAE2F8"],_=l()((e=>{let{tag:t,value:r,platform:s,is_mobile:n,organization:o}=e;(0,f.Gi)("issue_group_details.tags.bar.hovered",{tag:t,value:r,platform:s,is_mobile:n,organization:o})}),300);function D(e){let{colors:t=w,segments:r,title:s,totalValues:o,onTagClick:i,project:a,expandByDefault:l,otherUrl:u}=e;const m=(0,b.T)(),D=(0,y.Z)(),[k,R]=(0,n.useState)(!!l),[X,Y]=(0,n.useState)(null),G=r.slice(0,4),L=G.reduce(((e,t)=>e+t.count),0),W=L<o,U=(0,x.u3)(m.query.query,s,G.map((e=>{let{value:t}=e;return t}))),K={...m,query:{...m.query,query:U}};return W&&G.push({isOther:!0,name:(0,g.t)("Other"),value:"other",count:o-L,url:u??K??""}),(0,Z.tZ)(j,{children:(0,Z.BX)("details",{open:!0,"aria-expanded":k,onClick:e=>e.preventDefault(),children:[(0,Z.tZ)(B,{children:(0,Z.BX)(E,{clickable:!0,onClick:()=>R(!k),children:[!Array.isArray(r)||r.length<=0?(0,Z.tZ)(z,{children:(0,Z.tZ)(O,{children:s})}):(0,Z.BX)(z,{children:[(0,Z.tZ)(O,{children:s}),(0,Z.tZ)(d.u,{skipWrapper:!0,delay:800,title:G[0].name||(0,g.t)("n/a"),children:(0,Z.tZ)(q,{children:G[0].name||(0,g.t)("n/a")})}),(0,Z.tZ)(M,{borderless:!0,size:"zero",icon:(0,Z.tZ)(p.g,{direction:k?"up":"down",size:"xs"}),"aria-label":(0,g.t)("%s %s tag distribution",k?"Collapse":"Expand",s)})]}),0===o?(0,Z.tZ)(S,{children:(0,Z.tZ)("p",{children:(0,g.t)("No recent data.")})}):(0,Z.tZ)(S,{children:G.map(((e,r)=>{const n=(0,h.aQ)(e.count,o),l=Math.floor(n),u={index:r,onClick:()=>((0,f.Gi)("issue_group_details.tags.bar.clicked",{tag:s,value:e.value,platform:a?.platform,is_mobile:(0,v.an)(a?.platform),organization:D}),i?.(s,e))};return(0,Z.tZ)("div",{style:{width:n+"%"},onMouseOver:()=>{Y(e),_({tag:s,value:e.value,platform:a?.platform,is_mobile:(0,v.an)(a?.platform),organization:D})},onMouseLeave:()=>Y(null),children:e.isOther?(0,Z.tZ)(A,{"aria-label":(0,g.t)("Other segment"),color:t[t.length-1]}):(0,Z.tZ)($,{"aria-label":`${e.value} ${(0,g.t)("segment")}`,color:t[r],...u,children:0===r&&l>6?`${l}%`:null})},e.isOther?"other":`segment-${e.value}`)}))})]})}),(0,Z.tZ)(T,{expanded:k,animate:k?{height:"100%",opacity:1}:{height:"0",opacity:0},children:(0,Z.tZ)(N,{children:G.map(((e,r)=>{const n=Math.floor((0,h.aQ)(e.count,o)),i=!!X&&X.value!==e.value,a=X?.value===e.value,l=e.isOther?(0,g.t)("Other %s tag values, %s of all events. View other tags.",s,`${n}%`):(0,g.t)("%s, %s, %s of all events. View events with this tag value.",s,e.value,`${n}%`);return(0,Z.tZ)("li",{children:(0,Z.tZ)(c.Z,{to:e.url,"aria-label":l,children:(0,Z.BX)(C,{onMouseOver:()=>Y(e),onMouseLeave:()=>Y(null),children:[(0,Z.tZ)(P,{color:t[e.isOther?t.length-1:r],focus:a}),(0,Z.tZ)(d.u,{skipWrapper:!0,delay:800,title:e.name,children:(0,Z.tZ)(I,{unfocus:i,children:e.name??(0,Z.tZ)(V,{children:(0,g.t)("n/a")})})}),(0,Z.tZ)(F,{children:`${n}%`})]})})},`segment-${e.name}-${r}`)}))})})]})})}D.displayName="TagFacetsDistributionMeter";const k=D,j=(0,s.Z)("div",{target:"e1g8texm16"})("margin-bottom:",(0,m.D)(2),";"),E=(0,s.Z)("span",{target:"e1g8texm15"})((e=>e.clickable?"cursor: pointer":null),";"),S=(0,s.Z)("div",{target:"e1g8texm14"})({name:"andpxo",styles:"display:flex;overflow:hidden"}),z=(0,s.Z)("div",{target:"e1g8texm13"})("display:flex;font-size:",(e=>e.theme.fontSizeMedium),";justify-content:space-between;margin-bottom:",(0,m.D)(.25),";line-height:1.1;"),O=(0,s.Z)("div",{target:"e1g8texm12"})("flex:none;color:",(e=>e.theme.textColor),";font-weight:bold;font-size:",(e=>e.theme.fontSizeMedium),";margin-right:",(0,m.D)(1),";align-self:center;"),q=(0,s.Z)("div",{target:"e1g8texm11"})((e=>e.theme.overflowEllipsis),";display:flex;color:",(e=>e.theme.gray300),";text-align:right;font-size:",(e=>e.theme.fontSizeMedium),";",(e=>e.theme.overflowEllipsis),";align-self:center;"),A=(0,s.Z)("span",{target:"e1g8texm10"})("display:block;width:100%;height:",(0,m.D)(2),";color:inherit;outline:none;background-color:",(e=>e.color),";"),$=(0,s.Z)("span",{shouldForwardProp:o.Z,target:"e1g8texm9"})("&:hover{color:",(e=>e.theme.white),";}display:block;width:100%;height:",(0,m.D)(2),";color:",(e=>e.theme.white),";outline:none;background-color:",(e=>e.color),";text-align:right;font-size:",(e=>e.theme.fontSizeExtraSmall),";padding:1px ",(0,m.D)(.5)," 0 0;"),T=(0,s.Z)(i.E.div,{shouldForwardProp:e=>"animate"===e||"expanded"!==e&&(0,o.Z)(e),target:"e1g8texm8"})("height:0;opacity:0;",(e=>e.expanded?"":"overflow: hidden;"),";"),N=(0,s.Z)("ol",{target:"e1g8texm7"})("list-style:none;padding:0;margin:",(0,m.D)(1)," 0;"),C=(0,s.Z)("div",{target:"e1g8texm6"})("display:flex;align-items:center;cursor:pointer;padding:",(0,m.D)(.5)," 0;"),P=(0,s.Z)("span",{target:"e1g8texm5"})("padding:0;position:relative;width:11px;height:11px;text-indent:-9999em;display:inline-block;border-radius:50%;flex-shrink:0;background-color:",(e=>e.color),";&:after{content:'';border-radius:50%;position:absolute;top:0;left:0;width:100%;height:100%;outline:",(e=>e.theme.gray100)," ",(0,m.D)(.5)," solid;opacity:",(e=>e.focus?"1":"0"),";transition:opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);}"),I=(0,s.Z)("span",{target:"e1g8texm4"})("font-size:",(e=>e.theme.fontSizeSmall),";margin-left:",(0,m.D)(1),";overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:color 0.3s;color:",(e=>e.unfocus?e.theme.gray300:e.theme.gray400),";"),F=(0,s.Z)("span",{target:"e1g8texm3"})("font-size:",(e=>e.theme.fontSizeSmall),";margin-left:",(0,m.D)(1),";color:",(e=>e.theme.gray300),";text-align:right;flex-grow:1;"),M=(0,s.Z)(u.zx,{target:"e1g8texm2"})("color:",(e=>e.theme.gray300),";margin-left:",(0,m.D)(.5),";"),V=(0,s.Z)("span",{target:"e1g8texm1"})("color:",(e=>e.theme.gray300),";"),B=(0,s.Z)("summary",{target:"e1g8texm0"})({name:"l4bt0f",styles:"&::-webkit-details-marker{display:none;}"})},"./app/utils/getPeriod.tsx":(e,t,r)=>{r.d(t,{X:()=>a}),r("../node_modules/core-js/modules/es.error.cause.js");var s=r("../node_modules/moment/moment.js"),n=r.n(s),o=r("./app/constants/index.tsx"),i=r("./app/utils/dates.tsx");function a(e){let{period:t,start:r,end:s}=e,{shouldDoublePeriod:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t||r||s||(t=o.GY),t){if(!a)return{statsPeriod:t};const[,e,r]=t.match(/([0-9]+)([mhdw])/);return{statsPeriod:`${2*parseInt(e,10)}${r}`}}if(!r||!s)throw new Error("start and end required");const l=(0,i.v5)(r),u=(0,i.v5)(s);if(a){const e=n()(s).diff(n()(r)),t=n()(r).subtract(e);return{start:(0,i.v5)(t),end:u}}return{start:l,end:u}}},"./app/views/issueDetails/utils.tsx":(e,t,r)=>{r.d(t,{Ad:()=>g,M3:()=>h,V7:()=>l,by:()=>f,dG:()=>c,g5:()=>u,m7:()=>m,sC:()=>p});var s=r("../node_modules/lodash/orderBy.js"),n=r.n(s),o=r("./app/actionCreators/group.tsx"),i=r("./app/api.tsx"),a=r("./app/locale.tsx");function l(e,t,r,s){(0,o.Gv)(e,{orgId:t,projectId:r,itemIds:[s],failSilently:!0,data:{hasSeen:!0}},{})}function u(e,t){return(new i.KU).requestPromise(`/issues/${e}/user-reports/`,{includeAllArgs:!0,query:t})}function c(e){const t=e.tags.find((e=>{let{key:t}=e;return"environment"===t}));return t?t.value:null}const d={commented:(0,a.t)("You're receiving workflow notifications because you have commented on this issue."),assigned:(0,a.t)("You're receiving workflow notifications because you were assigned to this issue."),bookmarked:(0,a.t)("You're receiving workflow notifications because you have bookmarked this issue."),changed_status:(0,a.t)("You're receiving workflow notifications because you have changed the status of this issue."),mentioned:(0,a.t)("You're receiving workflow notifications because you have been mentioned in this issue.")};function p(e){if(e.subscriptionDetails&&e.subscriptionDetails.disabled)return(0,a.t)("You have disabled workflow notifications for this project.");if(!e.isSubscribed)return(0,a.t)("Subscribe to workflow notifications for this issue");if(e.subscriptionDetails){const{reason:t}=e.subscriptionDetails;if("unknown"===t)return(0,a.t)("You're receiving workflow notifications because you are subscribed to this issue.");if(t&&d.hasOwnProperty(t))return d[t]}return(0,a.t)("You're receiving updates because you are subscribed to workflow notifications for this project.")}function g(e){return n()([...e],(e=>{let{dateCreated:t}=e;return new Date(t)}),["desc"])[0]}let m;function h(e,t){const{status:r,count:s,activity:n}=e,o=Number(s);switch(r){case"reprocessing":return m.REPROCESSING;case"unresolved":{const e=t??g(n);return"reprocess"===e?.type?0===o?m.REPROCESSED_AND_HASNT_EVENT:m.REPROCESSED_AND_HAS_EVENT:m.NO_STATUS}default:return m.NO_STATUS}}!function(e){e.REPROCESSED_AND_HASNT_EVENT="reprocessed_and_hasnt_event",e.REPROCESSED_AND_HAS_EVENT="reprocessed_and_has_event",e.REPROCESSING="reprocessing",e.NO_STATUS="no_status"}(m||(m={}));const f=function(e){let{groupId:t,environment:r=[]}=e,{enabled:s=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,o.zk)({groupId:t,environment:r,readable:!0,limit:4},{enabled:s})}}}]);
//# sourceMappingURL=../sourcemaps/app_actionCreators_events_tsx-app_components_group_tagFacets_index_tsx.b727981f9673ffcd7d6dee7c3bbb40c2.js.map