"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_discover_charts_tsx-app_views_starfish_components_sparkline_tsx-app_views_starfish_-b3e740"],{"./app/utils/discover/charts.tsx":(e,t,r)=>{r.d(t,{CX:()=>o,Xp:()=>c,gu:()=>a,x1:()=>u});var s=r("./app/locale.tsx"),n=r("./app/utils.tsx"),i=r("./app/utils/formatters.tsx");function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"number";return(0,n.ri)(e)?function(e,t){if(!(0,n.ri)(e))return"—";switch(t){case"integer":case"number":return e.toLocaleString();case"percentage":return(0,i.rl)(e,2);case"duration":return(0,i.g9)(e/1e3,2,!0);case"size":return(0,n.F)(e);default:return e.toString()}}(e,t):"—"}function a(e,t){return u(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0)}function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;switch(t){case"integer":case"number":return r?(0,i.Du)(e):e.toLocaleString();case"percentage":return(0,i.rl)(e,0);case"duration":return function(e,t){if(t??=l(e),0===e)return"0";switch(t){case i.ps:{const t=(e/i.ps).toFixed(0);return(0,s.t)("%swk",t)}case i.x4:{const t=(e/i.x4).toFixed(0);return(0,s.t)("%sd",t)}case i.kr:{const t=(e/i.kr).toFixed(0);return(0,s.t)("%shr",t)}case i.EB:{const t=(e/i.EB).toFixed(0);return(0,s.t)("%smin",t)}case i.sh:{const t=(e/i.sh).toFixed(0);return(0,s.t)("%ss",t)}default:const t=e.toFixed(0);return(0,s.t)("%sms",t)}}(e,o);case"size":return(0,n.F)(e,0);default:return e.toString()}}function c(e,t){let r=0;const s=function(e,t){let r;if(e[0]?.data){let s,n=e[0];e.forEach(((r,i)=>{let{seriesName:o,data:a}=r;!1!==t?.selected?.[o]&&a.length&&(n=e[i],s??=e[i])})),s?.data&&(r={max:Math.max(...s.data.map((e=>{let{value:t}=e;return t})).filter((e=>!!e))),min:Math.min(...n.data.map((e=>{let{value:t}=e;return t})).filter((e=>!!e)))})}return r}(e,t);if(s){const e=(s.max+s.min)/2;r=l((s.max-s.min)/5),(e/r).toFixed(0).length>6&&(r=l(e))}return r}function l(e){return e>=i.ps?i.ps:e>=i.x4?i.x4:e>=i.kr?i.kr:e>=i.EB?i.EB:e>=i.sh?i.sh:1}},"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,r)=>{r.d(t,{AA:()=>x,JC:()=>b,ZP:()=>D,o:()=>h});var s=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=(r("../node_modules/core-js/modules/es.error.cause.js"),r("../node_modules/react/index.js")),i=r("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),o=r("./app/api.tsx"),a=r("./app/locale.tsx"),u=r("./app/utils/discover/eventView.tsx"),c=r("./app/utils/performance/contexts/performanceEventViewContext.tsx"),l=r("./app/views/organizationContext.tsx"),d=r("./app/utils/useApi.tsx"),p=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class h{constructor(e,t){(0,s.Z)(this,"message",void 0),(0,s.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class m extends n.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null,api:new o.KU}),(0,s.Z)(this,"_shouldRefetchData",(e=>{const t=w(this.props),r=w(e);return!(0,u.ze)(t,r)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,s.Z)(this,"_parseError",(e=>{if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const t=e.responseJSON?.detail;if("string"==typeof t)return new h(t,e);const r=t?.message;return new h("string"==typeof r?r:(0,a.t)("An unknown error occurred."),e)})),(0,s.Z)(this,"fetchData",(async()=>{const{queryBatching:e,beforeFetch:t,afterFetch:r,didFetch:s,eventView:n,orgSlug:i,route:o,setError:a}=this.props,{api:u}=this.state;if(!n.isValid())return;const c=`/organizations/${i}/${o}/`,l=Symbol("tableFetchID"),d=w(this.props);this.setState({isLoading:!0,tableFetchID:l}),a?.(void 0),t?.(u),u.clear();try{const[t,,n]=await x(u,c,d,{queryBatching:e});if(this.state.tableFetchID!==l)return;const i=r?r(t,this.props):t;s?.(i),this.setState((e=>({isLoading:!1,tableFetchID:void 0,error:null,pageLinks:n?.getResponseHeader("Link")??e.pageLinks,tableData:i})))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),a&&a(t??void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),r=!1===e.eventView.isValid()&&this.props.eventView.isValid(),s=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||r||s)&&this.fetchData()}render(){const{isLoading:e,error:t,tableData:r,pageLinks:s}=this.state,n={isLoading:e,error:t,tableData:r,pageLinks:s},i=this.props.children;return i?.(n)}}function g(e){const t=(0,n.useContext)(l.g)?.slug,r=(0,n.useContext)(c.uL)?.eventView,s=e.orgSlug??t,i=e.eventView??r;if(void 0===s||void 0===i)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const o={...e,orgSlug:s,eventView:i};return(0,p.tZ)(m,{...o})}m.displayName="_GenericDiscoverQuery",g.displayName="GenericDiscoverQuery";const f=200,v=2,y=e=>new Promise((t=>setTimeout(t,e)));async function x(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{queryBatching:n,retry:i}=s;if(n?.batchRequest)return n.batchRequest(e,t,{query:r,includeAllArgs:!0});const o=i?.baseTimeout??f,a=i?.timeoutMultiplier??v,u=i?.statusCodes??[],c=i?.tries??1;let l,d=0,p=0;for(;d<c&&(!l||u.includes(l.status));){p>0&&await y(p);try{return d++,await e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...r}})}catch(e){l=e,p=o*a**(d-1)}}throw l}function w(e){const{cursor:t,limit:r,noPagination:s,referrer:n,getRequestPayload:i,eventView:o,location:a,forceAppendRawQueryString:u}=e,c=i?i(e):o.getEventsAPIPayload(a,u);return t&&(c.cursor=t),r&&(c.per_page=r),s&&(c.noPagination=s),n&&(c.referrer=n),Object.assign(c,e.queryExtras??{}),c}function b(e){const t=(0,d.Z)(),{orgSlug:r,route:s}=e,n=`/organizations/${r}/${s}/`,o=w(e);return(0,i.a)([s,o],(async()=>{const[r]=await x(t,n,o,{queryBatching:e.queryBatching});return r}))}const D=g},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,r)=>{r.d(t,{bq:()=>n,uL:()=>o});var s=r("./app/utils/performance/contexts/utils.tsx");const[n,i,o]=(0,s.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,r)=>{r.d(t,{n:()=>n}),r("../node_modules/core-js/modules/es.error.cause.js");var s=r("../node_modules/react/index.js");function n(e){const{strict:t=!0,errorMessage:r=`useContext for "${e.name}" must be inside a Provider with a value`,name:n}=e,i=(0,s.createContext)(void 0);return i.displayName=n,[i.Provider,function(){const e=(0,s.useContext)(i);if(!e&&t)throw new Error(r);return e},i]}},"./app/views/starfish/components/sparkline.tsx":(e,t,r)=>{r.d(t,{K:()=>d,Z:()=>l});var s=r("../node_modules/echarts/lib/chart/line/install.js"),n=r("../node_modules/echarts/lib/extension.js"),i=r("../node_modules/echarts/core.js"),o=r("../node_modules/zrender/lib/svg/Painter.js");function a(e){e.registerPainter("svg",o.Z)}var u=r("../node_modules/echarts-for-react/lib/core.js"),c=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function l(e){let{series:t,width:r,color:o}=e;if(n.D([s.N,a]),!t.data)return null;const l={data:t.data.map((e=>e.value)),type:"line",showSymbol:!1,smooth:!0};return(0,c.tZ)(u.Z,{echarts:i,option:{color:o,series:[l],xAxis:{show:!1,data:t.data.map((e=>e.name)),type:"category"},yAxis:{show:!1,type:"value"},grid:{left:3,top:3,right:3,bottom:3}},notMerge:!0,style:{height:25,width:r??200},lazyUpdate:!0,theme:"theme_name"})}function d(e){let{series:t,markLine:r,width:o,height:l,color:d}=e;function p(e,t){return{data:e.data.map((e=>e.value)),type:"line",showSymbol:!1,smooth:!0,lineStyle:{color:d[t],width:[1,2][t]},yAxisIndex:t}}return n.D([s.N,a]),(0,c.tZ)(u.Z,{echarts:i,option:{series:[...t.map(((e,t)=>p(e,t))),r],xAxis:{show:!1,data:p(t[0],0).data.map((e=>e.name)),type:"category"},yAxis:[{show:!1,type:"value"},{show:!1,type:"value"}],grid:{left:3,top:3,right:3,bottom:3}},notMerge:!0,style:{height:l??25,width:o??200},lazyUpdate:!0,theme:"theme_name"})}l.displayName="Sparkline",d.displayName="MultiSparkline"},"./app/views/starfish/utils/constants.tsx":(e,t,r)=>{r.d(t,{M:()=>s});const s="http://localhost:8080"},"./app/views/starfish/utils/useSpansQuery.tsx":(e,t,r)=>{r.d(t,{bB:()=>m,Y7:()=>f}),r("../node_modules/core-js/modules/es.error.cause.js"),r("../node_modules/core-js/modules/es.array.push.js");var s=r("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),n=r("../node_modules/moment/moment.js"),i=r.n(n),o=r("./app/utils/discover/discoverQuery.tsx"),a=r("./app/utils/discover/eventView.tsx"),u=r("./app/utils/discover/genericDiscoverQuery.tsx"),c=r("./app/utils/useLocation.tsx"),l=r("./app/utils/useOrganization.tsx"),d=r("./app/views/starfish/utils/constants.tsx"),p=r("../node_modules/react/index.js");const h="YYYY-MM-DDTHH:mm:ss";function m(e){let{eventView:t,queryString:r,initialData:s,forceUseDiscover:n}=e;const{options:i}=function(){const[e,t]=(0,p.useState)({useDiscover:!1});return{options:e,setOptions:t}}(),{useDiscover:o}=i,a=function(e){let{useDiscover:t,isTimeseriesQuery:r}=e;return t?r?f:v:g}({useDiscover:n??o,isTimeseriesQuery:(t?.yAxis?.length??0)>0});if(function(e){return e===v}(a)||function(e){return e===f}(a)){if(t)return a(t,s);throw new Error("eventView argument must be defined when Starfish useDiscover is true")}if(r)return a(r,s);throw new Error("queryString argument must be defined when Starfish useDiscover is false, ie when using scraped data via fetch API")}function g(e,t){const{isLoading:r,data:n}=(0,s.a)({queryKey:[e],queryFn:()=>fetch(`${d.M}/?query=${e}`).then((e=>e.json())),retry:!1,initialData:t});return{isLoading:r,data:n}}function f(e,t){const r=(0,c.T)(),s=(0,l.Z)(),{isLoading:n,data:i}=(0,u.JC)({route:"events-stats",eventView:e,location:r,orgSlug:s.slug,getRequestPayload:()=>({...e.getEventsAPIPayload(r),yAxis:e.yAxis,topEvents:e.topEvents,excludeOther:1,partial:1,orderby:e.sorts?.[0]?(0,a.uZ)(e.sorts?.[0]):void 0,interval:e.interval})});return{isLoading:n,data:n&&t?t:y(i,e)}}function v(e,t){const r=(0,c.T)(),s=(0,l.Z)(),{isLoading:n,data:i}=(0,o._)({eventView:e,orgSlug:s.slug,location:r});return{isLoading:n,data:n&&t?t:i?.data}}function y(e,t){if(!t.yAxis)return[];let r=[];const s=t.yAxis&&("string"==typeof t.yAxis||1===t.yAxis.length),n="string"==typeof t.yAxis?t.yAxis:t.yAxis[0];return e.data?x(e,s?n:"count"):(Object.keys(e).forEach((t=>{e[t].data?r=w(r,x(e[t],s?n:t)):Object.keys(e[t]).forEach((s=>{"order"!==s&&(r=w(r,x(e[t][s],s,t)))}))})),r.map((e=>({...e,interval:i()(1e3*parseInt(e.interval,10)).format(h)}))))}function x(e,t,r){const s=[];return e.data.forEach((e=>{let[n,[{count:i}]]=e;const o=s.find((e=>e.interval===n&&(!r||e.group===r)));o?o[t]=i:s.push({interval:n,[t]:i,group:r})})),s}function w(e,t){const r=JSON.parse(JSON.stringify(e));return t.forEach((e=>{let{interval:t,group:s,...n}=e;const i=r.find((e=>e.interval===t&&(!s||e.group===s)));i?Object.keys(n).forEach((e=>{i[e]=n[e]})):r.push({interval:t,group:s,...n})})),r}}}]);
//# sourceMappingURL=../sourcemaps/app_utils_discover_charts_tsx-app_views_starfish_components_sparkline_tsx-app_views_starfish_-b3e740.3aea5903ce20c9ab7eb8265e8c25710f.js.map