"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_components_breakdownBar_tsx"],{"./app/views/starfish/components/breakdownBar.tsx":(t,e,n)=>{n.d(e,{Z:()=>w,c:()=>b});var a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=n("../node_modules/react/index.js"),o=n("../node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js"),r=n("../node_modules/framer-motion/dist/es/render/dom/motion.mjs"),s=n("./app/components/tooltip.tsx"),l=n("./app/locale.tsx"),d=n("./app/styles/space.tsx"),p=n("./app/utils.tsx"),c=n("./app/utils/queryClient.tsx");n("../node_modules/core-js/modules/es.array.push.js");var h=n("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),m=n("../node_modules/lodash/isNil.js"),u=n.n(m),g=n("../node_modules/moment/moment.js"),f=n.n(g),v=n("./app/views/starfish/components/chart.tsx"),y=n("./app/views/starfish/components/chartPanel.tsx"),x=n("./app/views/starfish/utils/zeroFillSeries.tsx"),_=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function $(t){let{isTopDataLoading:e,topData:n,isOtherDataLoading:a,otherData:i,throughputData:o}=t;const r=(0,h.u)(),s={};let d,p;e||a||(n.forEach((t=>{const e=b(t.span_operation,t.action,t.domain);s[e]={seriesName:`${e}`,data:[]}})),n.forEach((t=>{(u()(d)||f()(t.inteval)<d)&&(d=f()(t.interval)),(u()(p)||f()(t.inteval)>p)&&(p=f()(t.interval)),s[b(t.span_operation,t.action,t.domain)].data.push({value:t.p75,name:t.interval})})),s.Other={seriesName:"Other",data:[]},i.forEach((t=>{(u()(d)||f()(t.inteval)<d)&&(d=f()(t.interval)),(u()(p)||f()(t.inteval)>p)&&(p=f()(t.interval)),s.Other.data.push({value:t.p75,name:t.interval})})));const c=Object.values(s).map((t=>(0,x.b)(t,f().duration(1,"day"),d,p)));return(0,_.tZ)(y.Z,{title:(0,l.t)("p75 of span exclusive time"),children:(0,_.tZ)(v.Z,{statsPeriod:"24h",height:180,data:c,start:"",end:"",loading:e,utc:!1,grid:{left:"0",right:"0",top:"16px",bottom:"8px"},definedAxisTicks:4,stacked:!0,chartColors:r.charts.getColorPalette(5),throughput:o})})}$.displayName="WebServiceBreakdownChart";const D=["#402A65","#694D99","#9A81C4","#BBA6DF","#EAE2F8","#F8F6FC"],Z="http://localhost:8080";function b(t,e,n){return"http.client"===t?(0,l.t)("%s requests to %s",e,n):"db"===t?(0,l.t)("%s queries on %s",e,n):t||n||void 0}function E(t){let{title:e,transaction:n}=t;const[a,o]=(0,i.useState)(null),r=n??"",{data:d}=(0,c.aM)({queryKey:["webServiceSpanGrouping",r],queryFn:()=>fetch(`${Z}/?query=${(t=>{let{transaction:e}=t;return`SELECT domain, action, span_operation, sum(exclusive_time) as sum\n   FROM spans_experimental_starfish\n   WHERE span_operation NOT IN ['base.dispatch.execute', 'middleware.django', 'base.dispatch.request']\n   ${e?`AND transaction = '${e}'`:""}\n   GROUP BY domain, action, span_operation\n   ORDER BY -sum(exclusive_time)\n   LIMIT 5\n `})({transaction:r})}`).then((t=>t.json())),retry:!1,initialData:[]}),{data:h}=(0,c.aM)({queryKey:["totalCumulativeTime",r],queryFn:()=>fetch(`${Z}/?query=${(t=>{let{transaction:e}=t;return`SELECT sum(exclusive_time) as sum\n   FROM spans_experimental_starfish\n   ${e?`WHERE transaction = '${e}'`:""}\n `})({transaction:r})}`).then((t=>t.json())),retry:!1,initialData:[]}),m=h.reduce(((t,e)=>t+e.sum),0),u=d.reduce(((t,e)=>t+e.sum),0),g=m-u,f={span_operation:"other",sum:g,action:"",domain:""};let v=d.length>0?` (span_operation = '${d[0].span_operation}' ${d[0].action?`AND action = '${d[0].action}'`:""} ${d[0].domain?`AND domain = '${d[0].domain}'`:""})`:"";for(let t=1;t<d.length;t++){const e=d[t];v=v.concat(" OR ",`(span_operation = '${e.span_operation}' ${e.action?`AND action = '${e.action}'`:""} ${e.domain?`AND domain = '${e.domain}'`:""})`)}const{isLoading:y,data:x}=(0,c.aM)({queryKey:["topSpanGroupTimeseries",r,v],queryFn:()=>fetch(`${Z}/?query=${(t=>{let{transaction:e,topConditions:n}=t;return`SELECT\n quantile(0.75)(exclusive_time) as p75, domain, action, span_operation,\n toStartOfInterval(start_timestamp, INTERVAL 1 DAY) as interval\n FROM default.spans_experimental_starfish\n ${n?`WHERE (${n})`:""}\n ${n&&e?`AND transaction = '${e}'`:""}\n ${!n&&e?`WHERE transaction = '${e}'`:""}\n GROUP BY interval, domain, action, span_operation\n ORDER BY interval, domain, action, span_operation\n `})({transaction:r,topConditions:v})}`).then((t=>t.json())),retry:!1,initialData:[]}),{isLoading:E,data:w}=(0,c.aM)({queryKey:["otherSpanGroupTimeseries",r,v],queryFn:()=>fetch(`${Z}/?query=${(t=>{let{transaction:e,topConditions:n}=t;return`SELECT\n quantile(0.75)(exclusive_time) as p75,\n toStartOfInterval(start_timestamp, INTERVAL 1 DAY) as interval\n FROM default.spans_experimental_starfish\n ${n?`WHERE NOT (${n})`:""}\n ${n&&e?`AND transaction = '${e}'`:""}\n ${!n&&e?`WHERE transaction = '${e}'`:""}\n GROUP BY interval\n ORDER BY interval\n `})({transaction:r,topConditions:v})}`).then((t=>t.json())),retry:!1,initialData:[]}),{data:z}=(0,c.aM)({queryKey:["httpThroughputData",r],queryFn:()=>fetch(`${Z}/?query=${(t=>{let{transaction:e}=t;return`SELECT\n  count() as count,\n  toStartOfInterval(start_timestamp, INTERVAL 1 DAY) as interval\n  FROM default.spans_experimental_starfish\n  ${e?`WHERE transaction = '${e}'`:""}\n  GROUP BY interval\n  ORDER BY interval\n  `})({transaction:r})}`).then((t=>t.json())),retry:!1,initialData:[]});return(0,_.BX)(i.Fragment,{children:[(0,_.tZ)(q,{children:(0,_.BX)("details",{open:!0,"aria-expanded":!0,onClick:t=>t.preventDefault(),children:[(0,_.tZ)(L,{children:(0,_.BX)(O,{children:[(0,_.tZ)(k,{children:(0,_.tZ)(C,{children:e})}),0===m?(0,_.tZ)(R,{children:(0,_.tZ)("p",{children:(0,l.t)("No recent data.")})}):(0,_.BX)(R,{children:[d.map(((t,e)=>{const n=(0,p.aQ)(t.sum,m),a=Math.floor(n),i={index:e,onClick:()=>{}},r=b(t.span_operation,t.action,t.domain);return(0,_.tZ)("div",{style:{width:n+"%"},onMouseOver:()=>{o(t)},onMouseLeave:()=>o(null),children:(0,_.tZ)(s.u,{skipWrapper:!0,delay:800,title:r,children:(0,_.tZ)(S,{"aria-label":`${r} ${(0,l.t)("segment")}`,color:D[e],...i,children:0===e&&a>6?`${a}%`:null})})},`segment-${r}`)})),g>0&&(0,_.tZ)("div",{style:{width:(0,p.aQ)(g,m)+"%"},onMouseOver:()=>{o(f)},onMouseLeave:()=>o(null),children:(0,_.tZ)(s.u,{skipWrapper:!0,delay:800,title:"other",children:(0,_.tZ)(S,{"aria-label":"other segment",color:D[5],index:5,onClick:()=>{}})})},"segment-other")]})]})}),(0,_.tZ)(M,{expanded:!0,animate:{height:"100%",opacity:1},children:(0,_.tZ)(j,{children:d.map(((t,e)=>{const n=Math.floor((0,p.aQ)(t.sum,m)),i=!!a&&a!==t,r=a===t,s=b(t.span_operation,t.action,t.domain);return(0,_.tZ)("li",{children:(0,_.BX)(B,{onMouseOver:()=>o(t),onMouseLeave:()=>o(null),onClick:()=>{},children:[(0,_.tZ)(F,{color:D[e],focus:r}),(0,_.tZ)(T,{unfocus:i,children:s??(0,_.tZ)(A,{children:(0,l.t)("n/a")})}),(0,_.tZ)(N,{children:`${n}%`})]})},`segment-${s}-${e}`)}))})})]})}),(0,_.tZ)($,{isTopDataLoading:y,topData:x,isOtherDataLoading:E,otherData:w,throughputData:z})]})}E.displayName="FacetBreakdownBar";const w=E,q=(0,a.Z)("div",{target:"e165q70n13"})("margin-bottom:",(0,d.D)(2),";"),O=(0,a.Z)("span",{target:"e165q70n12"})((t=>t.clickable?"cursor: pointer":null),";"),R=(0,a.Z)("div",{target:"e165q70n11"})({name:"andpxo",styles:"display:flex;overflow:hidden"}),k=(0,a.Z)("div",{target:"e165q70n10"})("display:flex;font-size:",(t=>t.theme.fontSizeMedium),";justify-content:space-between;margin-bottom:",(0,d.D)(1),";line-height:1.1;"),C=(0,a.Z)("div",{target:"e165q70n9"})("flex:none;color:",(t=>t.theme.textColor),";font-weight:bold;font-size:",(t=>t.theme.fontSizeMedium),";margin-right:",(0,d.D)(1),";align-self:center;"),S=(0,a.Z)("span",{shouldForwardProp:o.Z,target:"e165q70n8"})("&:hover{color:",(t=>t.theme.white),";}display:block;width:100%;height:",(0,d.D)(2),";color:",(t=>t.theme.white),";outline:none;background-color:",(t=>t.color),";text-align:right;font-size:",(t=>t.theme.fontSizeExtraSmall),";padding:1px ",(0,d.D)(.5)," 0 0;"),M=(0,a.Z)(r.E.div,{shouldForwardProp:t=>"animate"===t||"expanded"!==t&&(0,o.Z)(t),target:"e165q70n7"})("height:0;opacity:0;",(t=>t.expanded?"":"overflow: hidden;"),";"),j=(0,a.Z)("ol",{target:"e165q70n6"})("list-style:none;padding:0;margin:",(0,d.D)(1)," 0;"),B=(0,a.Z)("div",{target:"e165q70n5"})("display:flex;align-items:center;cursor:pointer;padding:",(0,d.D)(.5)," 0;"),F=(0,a.Z)("span",{target:"e165q70n4"})("padding:0;position:relative;width:11px;height:11px;text-indent:-9999em;display:inline-block;border-radius:50%;flex-shrink:0;background-color:",(t=>t.color),";&:after{content:'';border-radius:50%;position:absolute;top:0;left:0;width:100%;height:100%;outline:",(t=>t.theme.gray100)," ",(0,d.D)(.5)," solid;opacity:",(t=>t.focus?"1":"0"),";transition:opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);}"),T=(0,a.Z)("span",{target:"e165q70n3"})("font-size:",(t=>t.theme.fontSizeSmall),";margin-left:",(0,d.D)(1),";overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:color 0.3s;color:",(t=>t.unfocus?t.theme.gray300:t.theme.gray400),";"),N=(0,a.Z)("span",{target:"e165q70n2"})("font-size:",(t=>t.theme.fontSizeSmall),";margin-left:",(0,d.D)(1),";color:",(t=>t.theme.gray300),";text-align:right;flex-grow:1;"),A=(0,a.Z)("span",{target:"e165q70n1"})("color:",(t=>t.theme.gray300),";"),L=(0,a.Z)("summary",{target:"e165q70n0"})({name:"l4bt0f",styles:"&::-webkit-details-marker{display:none;}"})}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_components_breakdownBar_tsx.7b6110f0ba4cc89064fe76a7fffa1a9b.js.map