"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_charts_lineChart_tsx-app_views_starfish_views_spanSummary_index_tsx"],{"./app/components/charts/lineChart.tsx":(e,t,n)=>{n.d(t,{w:()=>i});var a=n("./app/components/charts/series/lineSeries.tsx"),s=n("./app/components/charts/baseChart.tsx"),r=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e){let{series:t,seriesOptions:n,...i}=e;return(0,r.tZ)(s.Z,{...i,series:t.map((e=>{let{seriesName:t,data:s,dataArray:r,...i}=e;return(0,a.Z)({...n,...i,name:t,data:r||s?.map((e=>{let{value:t,name:n}=e;return[n,t]})),animation:!1,animationThreshold:1,animationDuration:0})}))})}i.displayName="LineChart"},"./app/components/performanceDuration.tsx":(e,t,n)=>{n.d(t,{Z:()=>o});var a=n("./app/components/duration.tsx"),s=n("./app/utils.tsx"),r=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e){const t=function(e){return(0,s.ri)(e.nanoseconds)}(e)?e.nanoseconds/1e9:function(e){return(0,s.ri)(e.milliseconds)}(e)?e.milliseconds/1e3:e.seconds;return(0,r.tZ)(a.Z,{abbreviation:e.abbreviation,seconds:t,fixedDigits:2})}i.displayName="PerformanceDuration";const o=i},"./app/utils/performance/contexts/pageError.tsx":(e,t,n)=>{n.d(t,{De:()=>l,V_:()=>o,YY:()=>p});var a=n("../node_modules/react/index.js"),s=n("./app/components/alert.tsx"),r=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const i=(0,a.createContext)({pageError:void 0,setPageError:e=>{}});function o(e){let{children:t}=e;const[n,s]=(0,a.useState)();return(0,r.tZ)(i.Provider,{value:{pageError:n,setPageError:s},children:t})}function p(){const{pageError:e}=(0,a.useContext)(i);return e?(0,r.tZ)(s.bZ,{type:"error","data-test-id":"page-error-alert",showIcon:!0,children:e}):null}o.displayName="PageErrorProvider",p.displayName="PageErrorAlert";const l=()=>(0,a.useContext)(i)},"./app/views/performance/transactionSummary/transactionSpans/spanDetails/spanDetailsTable.tsx":(e,t,n)=>{n.d(t,{Z:()=>b,i:()=>q});var a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("../node_modules/react/index.js"),r=n("./app/components/gridEditable/index.tsx"),i=n("./app/components/gridEditable/sortLink.tsx"),o=n("./app/components/links/link.tsx"),p=n("./app/components/pagination.tsx"),l=n("./app/components/performance/waterfall/rowBar.tsx"),c=n("./app/components/performance/waterfall/utils.tsx"),d=n("./app/components/performanceDuration.tsx"),u=n("./app/components/tooltip.tsx"),m=n("./app/locale.tsx"),h=n("./app/styles/space.tsx"),g=n("./app/utils.tsx"),f=n("./app/utils/discover/fieldRenderers.tsx"),_=n("./app/utils/discover/fields.tsx"),S=n("./app/utils/formatters.tsx"),x=n("./app/utils/performanceForSentry.tsx"),y=n("./app/views/performance/transactionSummary/utils.tsx"),v=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function b(e){const{location:t,organization:n,project:a,examples:i,suspectSpan:o,transactionName:l,isLoading:c,pageLinks:d}=e;if(!(0,g.ri)(i))return null;const u=i.filter((e=>e.spans.length>0)).map((e=>({id:e.id,project:a?.slug,timestamp:1e3*e.finishTimestamp,transactionDuration:1e3*(e.finishTimestamp-e.startTimestamp),spanDuration:e.nonOverlappingExclusiveTime,occurrences:e.spans.length,cumulativeDuration:e.spans.reduce(((e,t)=>e+t.exclusiveTime),0),spans:e.spans})));return(0,v.BX)(s.Fragment,{children:[(0,v.tZ)(x.oF,{id:"SpanDetails-SpanDetailsTable",hasData:!!u.length,isLoading:c,children:(0,v.tZ)(r.ZP,{isLoading:c,data:u,columnOrder:w,columnSortBy:[],grid:{renderHeadCell:D,renderBodyCell:Z(t,n,l,o)},location:t})}),(0,v.tZ)(p.Z,{pageLinks:d??null})]})}function D(e,t){const n=(0,_.qG)(e.key,E[e.key]);return(0,v.tZ)(i.Z,{title:e.name,align:n,direction:void 0,canSort:!1,generateSortLink:()=>{}})}function Z(e,t,n,a){return function(s,r){if("spanDuration"===s.key&&r.transactionDuration)return(0,v.tZ)(q,{spanOp:a?.op??"",spanDuration:r.spanDuration,transactionDuration:r.transactionDuration});let i=(0,f.Js)(s.key,E)(r,{location:e,organization:t});if("id"===s.key){const a=r.spans.length?r.spans.reduce(((e,t)=>e.exclusiveTime>=t.exclusiveTime?e:t)):null,s=(0,y.vd)(n)(t,r,e.query,a.id);i=(0,v.tZ)(o.Z,{to:s,children:i})}return i}}b.displayName="SpanTable",D.displayName="renderHeadCell";const E={id:"string",timestamp:"date",spanDuration:"duration",occurrences:"integer",cumulativeDuration:"duration"},w=[{key:"id",name:(0,m.t)("Event ID"),width:r.z7},{key:"timestamp",name:(0,m.t)("Timestamp"),width:r.z7},{key:"spanDuration",name:(0,m.t)("Span Duration"),width:r.z7},{key:"occurrences",name:(0,m.t)("Count"),width:r.z7},{key:"cumulativeDuration",name:(0,m.t)("Cumulative Duration"),width:r.z7}],$=(0,a.Z)("div",{target:"e1y3mgni1"})("position:relative;display:flex;top:",(0,h.D)(.5),";background-color:",(e=>e.theme.gray100),";"),N=(0,a.Z)(l.e,{target:"e1y3mgni0"})({name:"1ics03r",styles:"position:relative;width:100%;top:0"});function q(e){const{spanOp:t,spanDuration:n,transactionDuration:a}=e,s=n/a,r=s<.7?"right":"inset";return(0,v.tZ)($,{children:(0,v.tZ)("div",{style:{width:(0,c.yI)(s)},children:(0,v.tZ)(u.u,{title:(0,m._N)("[percentage] of the transaction",{percentage:(0,S.rl)(s)}),containerDisplayMode:"block",children:(0,v.tZ)(N,{style:{backgroundColor:(0,c.hd)(t)},children:(0,v.tZ)(l.R,{durationDisplay:r,showDetail:!1,children:(0,v.tZ)(d.Z,{abbreviation:!0,milliseconds:n})})})})})})}q.displayName="SpanDurationBar"},"./app/views/starfish/modules/APIModule/queries.tsx":(e,t,n)=>{n.d(t,{Ao:()=>d,J5:()=>f,O6:()=>i,Rj:()=>x,S4:()=>c,YK:()=>u,Z$:()=>_,Zn:()=>h,an:()=>p,eL:()=>y,g9:()=>l,hB:()=>o,jD:()=>v,o_:()=>g,tC:()=>S,xI:()=>m});var a=n("./app/utils/discover/eventView.tsx"),s=n("./app/utils/discover/types.tsx"),r=n("./app/views/starfish/utils/dates.tsx");const i=e=>{let{datetime:t}=e;const{start_timestamp:n,end_timestamp:a}=(0,r.SW)(t);return`SELECT\n    domain,\n    toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n    quantile(0.99)(exclusive_time) as p99,\n    count() as count,\n    countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as failure_count,\n    failure_count / count as failure_rate\n    FROM spans_experimental_starfish\n    WHERE module = 'http'\n    AND domain != ''\n    ${n?`AND greaterOrEquals(start_timestamp, '${n}')`:""}\n    ${a?`AND lessOrEquals(start_timestamp, '${a}')`:""}\n    GROUP BY domain, interval\n    ORDER BY domain, interval asc\n `},o=e=>{let{datetime:t}=e;return a.ZP.fromSavedQuery({name:"",fields:["domain"],yAxis:["p99(span.self_time)","count()"],query:"module:http",topEvents:"10",start:t.start,end:t.end,range:t.period,dataset:s.as.SPANS_INDEXED,projects:[1],version:2})},p=e=>{let{domain:t,action:n,datetime:a,transaction:s}=e;const{start_timestamp:i,end_timestamp:o}=(0,r.SW)(a);return`SELECT\n    description,\n    group_id,\n    domain,\n    action,\n    quantile(0.5)(exclusive_time) AS "p50(span.self_time)",\n    quantile(0.95)(exclusive_time) AS "p95(span.self_time)",\n    sum(exclusive_time) AS "sum(span.self_time)",\n    uniq(user) AS "count_unique(user)", uniq(transaction) AS "count_unique(transaction)",\n    count() AS count,\n    countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) AS failure_count,\n    failure_count / count AS failure_rate\n    FROM spans_experimental_starfish\n    WHERE module = 'http'\n    ${t?`AND domain = '${t}'`:""}\n    ${n?`AND action = '${n}'`:""}\n    ${s?`AND transaction = '${s}'`:""}\n    ${i?`AND greaterOrEquals(start_timestamp, '${i}')`:""}\n    ${o?`AND lessOrEquals(start_timestamp, '${o}')`:""}\n    GROUP BY description, domain, action, group_id\n    ORDER BY count DESC\n    LIMIT 10\n  `},l=e=>{let{domain:t,action:n,datetime:r,transaction:i}=e;return a.ZP.fromSavedQuery({name:"",fields:["description","group_id","domain","action","p50(span.self_time)","p95(span.self_time)","sum(span.self_time)","count()","count_unique(user)","count_unique(transaction)"],orderby:"-count",query:`module:http ${t?`domain:${t}`:""} ${n?`action:${n}`:""} ${i?`transaction:${i}`:""}`,start:r.start,end:r.end,range:r.period,dataset:s.as.SPANS_INDEXED,projects:[1],version:2})},c=e=>{let{datetime:t}=e;const{start_timestamp:n,end_timestamp:a}=(0,r.SW)(t);return`SELECT domain, count(),\n    sum(exclusive_time) as "sum(span.self_time)",\n    max(exclusive_time) as "p100(span.self_time)",\n    quantile(0.99)(exclusive_time) as "p99(span.self_time)",\n    quantile(0.95)(exclusive_time) as "p95(span.self_time)",\n    quantile(0.50)(exclusive_time) as "p50(span.self_time)"\n    FROM spans_experimental_starfish\n    WHERE module = 'http'\n    ${n?`AND greaterOrEquals(start_timestamp, '${n}')`:""}\n    ${a?`AND lessOrEquals(start_timestamp, '${a}')`:""}\n    GROUP BY domain\n    ORDER BY count() DESC\n  `},d=e=>{let{datetime:t}=e;return a.ZP.fromSavedQuery({name:"",fields:["domain","count()","sum(span.self_time)","p100(span.self_time)","p99(span.self_time)","p95(span.self_time)","p50(span.self_time)"],orderby:"-count",query:"module:http",start:t.start,end:t.end,range:t.period,dataset:s.as.SPANS_INDEXED,projects:[1],version:2})},u=e=>{let{datetime:t}=e;const{start_timestamp:n,end_timestamp:a}=(0,r.SW)(t);return`SELECT\n    toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n    quantile(0.5)(exclusive_time) as "p50(span.self_time)",\n    quantile(0.75)(exclusive_time) as "p75(span.self_time)",\n    quantile(0.95)(exclusive_time) as "p95(span.self_time)",\n    quantile(0.99)(exclusive_time) as "p99(span.self_time)",\n    count() as "count()",\n    countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as "failure_count()",\n    "failure_count()" / "count()" as "failure_rate()"\n    FROM spans_experimental_starfish\n    WHERE module = 'http'\n    ${n?`AND greaterOrEquals(start_timestamp, '${n}')`:""}\n    ${a?`AND lessOrEquals(start_timestamp, '${a}')`:""}\n    GROUP BY interval\n    ORDER BY interval asc\n `},m=e=>{let{datetime:t}=e;return a.ZP.fromSavedQuery({name:"",fields:["count()","p50(span.self_time)","p75(span.self_time)","p95(span.self_time)","p99(span.self_time)"],yAxis:["count()","p50(span.self_time)","p75(span.self_time)","p95(span.self_time)","p99(span.self_time)"],query:"module:http",start:t.start,end:t.end,range:t.period,dataset:s.as.SPANS_INDEXED,projects:[1],version:2})},h=e=>{let{description:t,transactionName:n,datetime:a,groupId:s}=e;const{start_timestamp:i,end_timestamp:o}=(0,r.SW)(a);return`SELECT\n     toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n     quantile(0.5)(exclusive_time) as p50,\n     quantile(0.95)(exclusive_time) as p95,\n     count() as count,\n     countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as failure_count,\n     failure_count / count as failure_rate\n     FROM spans_experimental_starfish\n     WHERE module = 'http'\n     ${t?`AND description = '${t}'`:""}\n     ${s?`AND group_id = '${s}'`:""}\n     ${n?`AND transaction = '${n}'`:""}\n     ${i?`AND greaterOrEquals(start_timestamp, '${i}')`:""}\n     ${o?`AND lessOrEquals(start_timestamp, '${o}')`:""}\n     GROUP BY interval\n     ORDER BY interval asc\n  `},g=e=>{let{description:t,transactionName:n,datetime:a,groupId:s}=e;const{start_timestamp:i,end_timestamp:o}=(0,r.SW)(a);return`\n    SELECT transaction,\n    count(),\n    quantile(0.5)(exclusive_time) as "p50(span.self_time)",\n    quantile(0.95)(exclusive_time) as "p95(span.self_time)",\n    countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as failure_count,\n    failure_count / count() as failure_rate,\n    sum(exclusive_time) as "sum(span.self_time)",\n    count(DISTINCT transaction_id) as "count_unique(transaction)"\n    FROM spans_experimental_starfish\n    WHERE module = 'http'\n    ${t?`AND description = '${t}'`:""}\n    ${s?`AND group_id = '${s}'`:""}\n    ${n?`AND transaction = '${n}'`:""}\n    ${i?`AND greaterOrEquals(start_timestamp, '${i}')`:""}\n    ${o?`AND lessOrEquals(start_timestamp, '${o}')`:""}\n    GROUP BY transaction\n    ORDER BY count() DESC\n    LIMIT 5\n `},f=e=>{let{description:t,transactionName:n,datetime:r,groupId:i}=e;return a.ZP.fromSavedQuery({name:"",fields:["transaction","count()","p50(span.self_time)","p95(span.self_time)","sum(span.self_time)","count_unique(transaction)"],orderby:"-count",query:`module:http ${t?`description:${t}`:""} ${n?`transaction:${n}`:""} ${i?`group_id:${i}`:""}`,start:r.start,end:r.end,range:r.period,dataset:s.as.SPANS_INDEXED,projects:[1],version:2})},_=e=>{let{groupId:t,datetime:n}=e;const{start_timestamp:a,end_timestamp:s}=(0,r.SW)(n);return`\n    SELECT count() AS count, quantile(0.5)(exclusive_time) as p50, span_operation\n    FROM spans_experimental_starfish\n    WHERE group_id = '${t}'\n    ${a?`AND greaterOrEquals(start_timestamp, '${a}')`:""}\n    ${s?`AND lessOrEquals(start_timestamp, '${s}')`:""}\n    GROUP BY span_operation\n `},S=e=>{let{groupId:t,datetime:n}=e;const{start_timestamp:a,end_timestamp:s}=(0,r.SW)(n);return`\n    SELECT transaction, user, domain\n    FROM spans_experimental_starfish\n    WHERE group_id = '${t}'\n    ${a?`AND greaterOrEquals(start_timestamp, '${a}')`:""}\n    ${s?`AND lessOrEquals(start_timestamp, '${s}')`:""}\n `},x=e=>{let{domain:t,datetime:n}=e;const{start_timestamp:a,end_timestamp:s}=(0,r.SW)(n);return`\n    SELECT count() as count, status\n    FROM spans_experimental_starfish\n    WHERE module = 'http'\n    AND domain = '${t}'\n    ${a?`AND greaterOrEquals(start_timestamp, '${a}')`:""}\n    ${s?`AND lessOrEquals(start_timestamp, '${s}')`:""}\n    GROUP BY status\n    ORDER BY count DESC\n  `},y=e=>{let{domain:t,datetime:n}=e;return a.ZP.fromSavedQuery({name:"",fields:["status","count()"],orderby:"-count",query:`module:http domain:${t}`,start:n.start,end:n.end,range:n.period,dataset:s.as.SPANS_INDEXED,projects:[1],version:2})},v=e=>{let{datetime:t,transaction:n}=e;const{start_timestamp:a,end_timestamp:s}=(0,r.SW)(t);return`\n    SELECT\n    description,\n    toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n    count() AS count,\n    quantile(0.5)(exclusive_time) as p50\n    FROM spans_experimental_starfish\n    WHERE module = 'http'\n    ${n?`AND transaction = '${n}'`:""}\n    ${a?`AND greaterOrEquals(start_timestamp, '${a}')`:""}\n    ${s?`AND lessOrEquals(start_timestamp, '${s}')`:""}\n    GROUP BY description, interval\n    ORDER BY interval asc\n  `}},"./app/views/starfish/views/spanSummary/index.tsx":(e,t,n)=>{n.r(t),n.d(t,{OverflowEllipsisTextContainer:()=>Me,default:()=>Pe});var a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=n("../node_modules/react/index.js"),r=n("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),i=n("../node_modules/lodash/keyBy.js"),o=n.n(i),p=n("../node_modules/lodash/orderBy.js"),l=n.n(p),c=n("../node_modules/query-string/index.js"),d=n("./app/components/button.tsx"),u=n("./app/components/datePageFilter.tsx"),m=n("./app/components/dateTime.tsx"),h=n("./app/components/events/interfaces/keyValueList/index.tsx"),g=n("./app/components/gridEditable/index.tsx"),f=n("./app/components/layouts/thirds.tsx"),_=n("./app/components/links/link.tsx"),S=n("./app/components/switchButton.tsx"),x=n("./app/components/tagDistributionMeter.tsx"),y=n("./app/locale.tsx"),v=n("./app/styles/space.tsx"),b=n("./app/utils/performance/contexts/pageError.tsx"),D=n("./app/utils/queryClient.tsx"),Z=n("./app/utils/usePageFilters.tsx"),E=n("./app/views/performance/transactionSummary/transactionSpans/spanDetails/spanDetailsTable.tsx"),w=n("./app/views/starfish/modules/APIModule/endpointTable.tsx"),$=n("./app/views/starfish/modules/APIModule/queries.tsx"),N=n("./app/views/starfish/utils/constants.tsx"),q=n("./app/icons/index.tsx"),R=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),O=(n("../node_modules/core-js/modules/es.array.push.js"),n("./app/components/events/interfaces/spans/dividerHandlerManager.tsx")),C=n("./app/components/count.tsx"),A=n("./app/components/events/interfaces/spans/utils.tsx"),T=n("./app/components/performance/waterfall/row.tsx"),k=n("./app/components/performance/waterfall/rowDivider.tsx"),I=n("./app/components/performance/waterfall/rowTitle.tsx"),B=n("./app/components/performance/waterfall/treeConnector.tsx"),L=n("./app/components/performance/waterfall/utils.tsx"),j=n("./app/utils/theme.tsx");const P=(0,a.Z)("div",{target:"e1l9h6yn0"})({name:"y9c2ja",styles:"position:relative;height:100%;min-width:1px;user-select:none;transition:border-color 0.15s ease-in-out;border-right:1px solid rgba(0, 0, 0, 0)"});function M(e){let{parent_span_id:t,baseChildren:n,regressionChildren:a}=e;const s=[],r=[],i=[...a];for(const e of n){const n=i.reduce(((t,n,a)=>(X({baselineSpan:e,regressionSpan:n})&&t.push({regressionSpan:n,index:a}),t)),[]);if(0===n.length){r.push({comparisonResult:"baseline",baselineSpan:e});continue}const a=Math.abs(e.timestamp-e.start_timestamp),{regressionSpan:o,index:p}=n.reduce(((t,n)=>{const{regressionSpan:s}=t,{regressionSpan:r}=n,i=Math.abs(s.start_timestamp-e.start_timestamp),o=Math.abs(r.start_timestamp-e.start_timestamp),p=Math.abs(s.timestamp-s.start_timestamp),l=Math.abs(r.timestamp-r.start_timestamp),c=Math.abs(p-a)+i,d=Math.abs(l-a)+o;return c<d?t:c>d?n:t}));i.splice(p,1),s.push({type:"descendent",parent_span_id:t,baselineSpan:e,regressionSpan:o}),r.push({comparisonResult:"matched",span_id:F({baselineSpan:e,regressionSpan:o}),op:e.op,description:e.description,baselineSpan:e,regressionSpan:o})}for(const e of i)r.push({comparisonResult:"regression",regressionSpan:e});return r.sort(G),{comparablePairs:s,children:r}}function X(e){let{baselineSpan:t,regressionSpan:n}=e;const a=t.op===n.op,s=t.description===n.description;return a&&s}function F(e){let{baselineSpan:t,regressionSpan:n}=e;return`${t.span_id}${n.span_id}`}function H(e){switch(e.comparisonResult){case"matched":return Math.max(W(e.baselineSpan),W(e.regressionSpan));case"baseline":return W(e.baselineSpan);case"regression":return W(e.regressionSpan);default:throw Error("Unknown comparisonResult")}}function W(e){return Math.abs(e.timestamp-e.start_timestamp)}function U(e){let{baselineSpan:t,regressionSpan:n}=e;return W(n)-W(t)}function Y(e,t){const n=H(e),a=H(t);return n>a?-1:n<a?1:0}function z(e,t){const n=W(e),a=W(t);return n>a?-1:n<a?1:e.start_timestamp<t.start_timestamp?-1:e.start_timestamp>t.start_timestamp?1:0}function G(e,t){switch(e.comparisonResult){case"regression":switch(t.comparisonResult){case"regression":return z(e.regressionSpan,t.regressionSpan);case"baseline":case"matched":return-1;default:throw Error("Unknown comparisonResult")}case"baseline":switch(t.comparisonResult){case"baseline":return z(e.baselineSpan,t.baselineSpan);case"regression":case"matched":return 1;default:throw Error("Unknown comparisonResult")}case"matched":switch(t.comparisonResult){case"regression":return 1;case"baseline":return-1;case"matched":{const n=U({regressionSpan:e.regressionSpan,baselineSpan:e.baselineSpan}),a=U({regressionSpan:t.regressionSpan,baselineSpan:t.baselineSpan});return n>0?a>0?n>a?-1:n<a?1:Y(e,t):-1:0===n?a>0?1:a<0?-1:Y(e,t):a>=0?1:n<a?-1:n>a?1:Y(e,t)}default:throw Error("Unknown comparisonResult")}default:throw Error("Unknown comparisonResult")}}function Q(e){switch(e.comparisonResult){case"matched":return e.span_id;case"baseline":return e.baselineSpan.span_id;case"regression":return e.regressionSpan.span_id;default:throw Error("Unknown comparisonResult")}}function V(e){switch(e.comparisonResult){case"matched":return e.op;case"baseline":return e.baselineSpan.op;case"regression":return e.regressionSpan.op;default:throw Error("Unknown comparisonResult")}}function K(e){switch(e.comparisonResult){case"matched":return(0,A.ro)(e.baselineSpan)||(0,A.ro)(e.regressionSpan);case"baseline":return(0,A.ro)(e.baselineSpan);case"regression":return(0,A.ro)(e.regressionSpan);default:throw Error("Unknown comparisonResult")}}function J(e){let{duration:t,largestDuration:n}=e;return t<=0?{type:"WIDTH_PIXEL",width:1}:{type:"WIDTH_PERCENTAGE",width:t/n}}function ee(e){if(e)switch(e.type){case"WIDTH_PIXEL":return`${e.width}px`;case"WIDTH_PERCENTAGE":return(0,L.yI)(e.width);default:return e}}n("../node_modules/core-js/modules/es.error.cause.js");var te=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class ne extends s.Component{constructor(){super(...arguments),(0,R.Z)(this,"renderDivider",(e=>{const{addDividerLineRef:t}=e;return(0,te.tZ)(k.xN,{ref:t(),style:{position:"relative"},onMouseEnter:()=>{e.setHover(!0)},onMouseLeave:()=>{e.setHover(!1)},onMouseOver:()=>{e.setHover(!0)},onMouseDown:e.onDragStart,onClick:e=>{e.stopPropagation()}})}))}renderTreeConnector(e){let{hasToggler:t}=e;const{isLast:n,isRoot:a,treeDepth:s,continuingTreeDepths:r,span:i,showSpanTree:o}=this.props,p=Q(i);if(a)return t?(0,te.tZ)(B.UV,{style:{right:"16px",height:"10px",bottom:"-5px",top:"auto"},orphanBranch:!1},`${p}-last`):null;const l=r.map((e=>{const t=(0,A.h_)(e);if(0===t)return null;const n=-1*((s-t)*(B.Ll/2)+1);return(0,te.tZ)(B.UV,{style:{left:n},orphanBranch:(0,A.yn)(e)},`${p}-${t}`)}));return t&&o&&l.push((0,te.tZ)(B.UV,{style:{right:"16px",height:"10px",bottom:n?"-25px":"0",top:"auto"},orphanBranch:!1},`${p}-last`)),(0,te.tZ)(B.DN,{isLast:n,hasToggler:t,orphanBranch:K(i),children:l})}renderSpanTreeToggler(e){let{left:t}=e;const{numOfSpanChildren:n,isRoot:a,showSpanTree:s}=this.props,r=(0,te.tZ)(q.g6,{direction:s?"up":"down"});if(n<=0)return(0,te.tZ)(B.rw,{style:{left:`${t}px`},children:this.renderTreeConnector({hasToggler:!1})});const i=a?null:(0,te.tZ)("div",{children:r});return(0,te.BX)(B.rw,{style:{left:`${t}px`},hasToggler:!0,children:[this.renderTreeConnector({hasToggler:!0}),(0,te.BX)(B.U1,{disabled:!!a,isExpanded:this.props.showSpanTree,onClick:e=>{e.stopPropagation(),a||this.props.toggleSpanTree()},errored:!1,children:[(0,te.tZ)(C.Z,{value:n}),i]})]})}renderTitle(){const{span:e,treeDepth:t}=this.props,n=V(e)?(0,te.BX)("strong",{children:[(0,te.tZ)("span",{children:V(e)})," — "]}):"",a=function(e){switch(e.comparisonResult){case"matched":return e.description;case"baseline":return e.baselineSpan.description;case"regression":return e.regressionSpan.description;default:throw Error("Unknown comparisonResult")}}(e)??("matched"===e.comparisonResult?(0,y.t)("matched"):Q(e)),s=t*(B.Ll/2);return(0,te.BX)(I.mw,{children:[this.renderSpanTreeToggler({left:s}),(0,te.tZ)(I.Wh,{style:{left:`${s}px`,width:"100%"},children:(0,te.BX)("span",{children:[n,a]})})]})}getSpanBarStyles(){const{span:e,generateBounds:t}=this.props,n=t(e);function a(e){if(e)return`max(1px, calc(${e} - 2px))`}switch(e.comparisonResult){case"matched":{const t=W(e.baselineSpan),s=W(e.regressionSpan);return t===s?{background:{color:void 0,width:a(ee(n.background)),hatch:!0},foreground:void 0}:t>s?{background:{color:j.ZP.gray500,width:a(ee(n.background))},foreground:{color:void 0,width:a(ee(n.foreground)),hatch:!0}}:{background:{color:j.ZP.purple300,width:a(ee(n.background))},foreground:{color:void 0,width:a(ee(n.foreground)),hatch:!0}}}case"regression":return{background:{color:j.ZP.purple300,width:a(ee(n.background))},foreground:void 0};case"baseline":return{background:{color:j.ZP.gray500,width:a(ee(n.background))},foreground:void 0};default:return e}}renderComparisonReportLabel(){const{span:e}=this.props;switch(e.comparisonResult){case"matched":{const t=W(e.baselineSpan),n=W(e.regressionSpan);let a="";if(t===n&&(a="no change"),t>n){const e=(0,L.bQ)(Math.abs(t-n));a=(0,y.t)("- %s faster",e)}if(t<n){const e=(0,L.bQ)(Math.abs(t-n));a=(0,y.t)("+ %s slower",e)}return(0,te.tZ)(re,{children:a})}case"baseline":return(0,te.tZ)(re,{children:(0,y.t)("removed from baseline")});case"regression":return(0,te.tZ)(re,{children:(0,y.t)("missing from regression")});default:return e}}renderHeader(e){const{dividerPosition:t,addGhostDividerLineRef:n}=e,{spanNumber:a}=this.props,s=this.getSpanBarStyles(),r=s.foreground?(0,te.tZ)(se,{spanBarHatch:s.foreground.hatch??!1,style:{backgroundColor:s.foreground.color,width:s.foreground.width,display:"block"}}):null;return(0,te.BX)(T.Qc,{children:[(0,te.tZ)(T.E5,{"data-type":"span-row-cell",style:{width:`calc(${(0,L.yI)(t)} - 0.5px)`},children:this.renderTitle()}),this.renderDivider(e),(0,te.BX)(T.E5,{"data-type":"span-row-cell",showStriping:a%2!=0,style:{width:`calc(${(0,L.yI)(1-t)} - 0.5px)`},children:[(0,te.tZ)(se,{spanBarHatch:s.background.hatch??!1,style:{backgroundColor:s.background.color,width:s.background.width,display:"block"}}),r,this.renderComparisonReportLabel()]}),(0,te.tZ)(k.Hr,{style:{width:`calc(${(0,L.yI)(t)} + 0.5px)`,display:"none"},children:(0,te.tZ)(k.xN,{ref:n(),style:{right:0},className:"hovering",onClick:e=>{e.stopPropagation()}})})]})}render(){return(0,te.tZ)(T.X2,{visible:!0,"data-test-id":"span-row",children:(0,te.tZ)(O.$,{children:e=>this.renderHeader(e)})})}}ne.displayName="SpanBar";const ae=e=>{let{spanBarHatch:t}=e;return!0===t?"\n        background-image: linear-gradient(135deg, #9f92fa 33.33%, #302839 33.33%, #302839 50%, #9f92fa 50%, #9f92fa 83.33%, #302839 83.33%, #302839 100%);\n        background-size: 4.24px 4.24px;\n    ":null},se=(0,a.Z)(P,{target:"ebampj51"})("position:absolute;top:4px;left:1px;height:16px;",ae,";"),re=(0,a.Z)("div",{target:"ebampj50"})("position:absolute;user-select:none;right:",(0,v.D)(1),";line-height:16px;top:4px;height:16px;font-size:",(e=>e.theme.fontSizeExtraSmall),";"),ie=ne;class oe extends s.Component{constructor(){super(...arguments),(0,R.Z)(this,"state",{showSpanTree:!0}),(0,R.Z)(this,"toggleSpanTree",(()=>{this.setState((e=>({showSpanTree:!e.showSpanTree})))}))}renderSpanChildren(){return this.state.showSpanTree?this.props.renderedSpanChildren:null}render(){const{span:e,treeDepth:t,continuingTreeDepths:n,spanNumber:a,isLast:r,isRoot:i,numOfSpanChildren:o,generateBounds:p}=this.props;return(0,te.BX)(s.Fragment,{children:[(0,te.tZ)(ie,{span:e,treeDepth:t,continuingTreeDepths:n,spanNumber:a,isLast:r,isRoot:i,numOfSpanChildren:o,showSpanTree:this.state.showSpanTree,toggleSpanTree:this.toggleSpanTree,generateBounds:p}),this.renderSpanChildren()]})}}oe.displayName="SpanGroup";const pe=oe;class le extends s.Component{constructor(){super(...arguments),(0,R.Z)(this,"traceViewRef",s.createRef())}renderSpan(e){let{span:t,childSpans:n,spanNumber:a,treeDepth:r,continuingTreeDepths:i,isLast:o,isRoot:p,generateBounds:l}=e;const c=n?.[Q(t)]??[];n={...n},delete n[Q(t)];const d=K(t)?{type:"orphan",depth:r}:r,u=o?i:[...i,d],m=c.reduce(((e,t,a)=>{const i=`${Q(t)}`,o=this.renderSpan({spanNumber:e.nextSpanNumber,isLast:a+1===c.length,isRoot:!1,span:t,childSpans:n,continuingTreeDepths:u,treeDepth:r+1,generateBounds:l});return e.renderedSpanChildren.push((0,te.tZ)(s.Fragment,{children:o.spanTree},i)),e.nextSpanNumber=o.nextSpanNumber,e}),{renderedSpanChildren:[],nextSpanNumber:a+1}),h=(0,te.tZ)(s.Fragment,{children:(0,te.tZ)(pe,{spanNumber:a,span:t,renderedSpanChildren:m.renderedSpanChildren,treeDepth:r,continuingTreeDepths:i,isRoot:p,isLast:o,numOfSpanChildren:c.length,generateBounds:l})});return{nextSpanNumber:m.nextSpanNumber,spanTree:h}}renderRootSpans(){const{baselineEvent:e,regressionEvent:t}=this.props,n=function(e){let{baselineEvent:t,regressionEvent:n}=e;const a=(0,A.k9)(t),s=(0,A.k9)(n),r=[],i={};for(const[e,t]of Object.entries(a.childSpans))i[e]=t.map((e=>({comparisonResult:"baseline",baselineSpan:e})));for(const[e,t]of Object.entries(s.childSpans))i[e]=t.map((e=>({comparisonResult:"regression",regressionSpan:e})));const o=[{type:"root",baselineSpan:(0,A.n0)(a),regressionSpan:(0,A.n0)(s)}];for(;o.length>0;){const e=o.pop();if(!e)break;const{baselineSpan:t,regressionSpan:n}=e;if(!X({baselineSpan:t,regressionSpan:n})){if("root"===e.type){const e=[{comparisonResult:"baseline",baselineSpan:t},{comparisonResult:"regression",regressionSpan:n}];r.push(...e)}continue}const p={comparisonResult:"matched",span_id:F({baselineSpan:t,regressionSpan:n}),op:t.op,description:t.description,baselineSpan:t,regressionSpan:n};"root"===e.type&&r.push(p);const{comparablePairs:l,children:c}=M({parent_span_id:p.span_id,baseChildren:a.childSpans[t.span_id]??[],regressionChildren:s.childSpans[n.span_id]??[]});o.push(...l),c.length>0&&(i[p.span_id]=c)}return r.sort(G),{rootSpans:r,childSpans:i}}({baselineEvent:e,regressionEvent:t}),{rootSpans:a,childSpans:r}=n,i=function(e){const t=Math.max(...e.map((e=>H(e))));return e=>{switch(e.comparisonResult){case"matched":{const n=W(e.baselineSpan),a=W(e.regressionSpan),s=J({duration:n,largestDuration:t}),r=J({duration:a,largestDuration:t});return n>=a?{background:s,foreground:r,baseline:s,regression:r}:{background:r,foreground:s,baseline:s,regression:r}}case"regression":{const n=J({duration:W(e.regressionSpan),largestDuration:t});return{background:n,foreground:void 0,baseline:void 0,regression:n}}case"baseline":{const n=J({duration:W(e.baselineSpan),largestDuration:t});return{background:n,foreground:void 0,baseline:n,regression:void 0}}default:return e}}}(a);let o=1;return{spanTree:(0,te.tZ)(s.Fragment,{children:a.map(((e,t)=>{const n=this.renderSpan({isLast:t+1===a.length,isRoot:!0,span:e,childSpans:r,spanNumber:o,treeDepth:0,continuingTreeDepths:[],generateBounds:i});return o=n.nextSpanNumber,(0,te.tZ)(s.Fragment,{children:n.spanTree},String(t))}))},"root-spans-tree"),nextSpanNumber:o}}render(){const{spanTree:e}=this.renderRootSpans();return(0,te.tZ)(O.z,{interactiveLayerRef:this.traceViewRef,children:(0,te.tZ)(ce,{ref:this.traceViewRef,children:e})})}}le.displayName="SpanTree";const ce=(0,a.Z)("div",{target:"e1k1xbfw0"})({name:"1wr20zt",styles:"overflow-x:hidden;border-bottom-left-radius:3px;border-bottom-right-radius:3px"}),de=le;function ue(e){let{left:t,right:n,clearLeft:a,clearRight:s}=e;const{isLoading:r,data:i}=(0,D.aM)({queryKey:[t],queryFn:()=>t&&fetch(`/api/0/organizations/sentry/events/sentry:${t}/`).then((e=>e.json())),retry:!1,initialData:{}}),{isLoading:o,data:p}=(0,D.aM)({queryKey:[n],queryFn:()=>n&&fetch(`/api/0/organizations/sentry/events/sentry:${n}/`).then((e=>e.json())),retry:!1,initialData:{}});return(0,te.BX)(me,{children:[(0,te.BX)(he,{children:[(0,te.BX)(fe,{children:[(0,te.tZ)("span",{children:t}),(0,te.tZ)(d.zx,{"aria-label":(0,y.t)("Close left event preview."),priority:"link",onClick:a,icon:(0,te.tZ)(q.bM,{size:"sm"})})]}),(0,te.tZ)(ge,{children:(0,te.tZ)("pre",{children:JSON.stringify(i,null,4)})})]}),(0,te.BX)(he,{children:[(0,te.BX)(fe,{children:[(0,te.tZ)("span",{children:n}),(0,te.tZ)(d.zx,{"aria-label":(0,y.t)("Close right event preview."),priority:"link",onClick:s,icon:(0,te.tZ)(q.bM,{size:"sm"})})]}),(0,te.tZ)(ge,{children:(0,te.tZ)("pre",{children:JSON.stringify(p,null,4)})})]}),i?.entries&&p?.entries&&(0,te.tZ)(_e,{children:(0,te.tZ)(de,{baselineEvent:i,regressionEvent:p})})]})}ue.displayName="EventComparisonView";const me=(0,a.Z)("div",{target:"ex6k0qf4"})("display:flex;flex-direction:row;margin-bottom:",(0,v.D)(2),";gap:",(0,v.D)(2),";flex-wrap:wrap;"),he=(0,a.Z)("div",{target:"ex6k0qf3"})({name:"1qf7kmn",styles:"display:flex;flex-direction:column;flex:1;min-width:500px"}),ge=(0,a.Z)("div",{target:"ex6k0qf2"})("overflow:auto;max-height:300px;border:1px solid ",(e=>e.theme.border),";"),fe=(0,a.Z)("div",{target:"ex6k0qf1"})("display:flex;flex-direction:row;justify-content:space-between;color:",(e=>e.theme.gray500),";&>button{color:",(e=>e.theme.gray500),";}"),_e=(0,a.Z)("div",{target:"ex6k0qf0"})("overflow:scroll;flex:1;min-width:1000px;max-height:500px;border:1px solid ",(e=>e.theme.border),";");var Se=n("../node_modules/@emotion/react/dist/emotion-element-6a883da9.browser.esm.js"),xe=n("../node_modules/moment/moment.js"),ye=n.n(xe),ve=n("./app/views/starfish/components/chart.tsx"),be=n("./app/views/starfish/utils/dates.tsx"),De=n("./app/views/starfish/utils/zeroFillSeries.tsx");const Ze=e=>{let{groupId:t,transactionName:n,user:a,datetime:s}=e;const{start_timestamp:r,end_timestamp:i}=(0,be.SW)(s);return`\n    SELECT transaction_id, transaction, description, user, domain, span_id, sum(exclusive_time) as exclusive_time\n    FROM spans_experimental_starfish\n    WHERE group_id = '${t}'\n    ${n?`AND transaction = '${n}'`:""}\n    ${a?`AND user = '${a}'`:""}\n    ${r?`AND greaterOrEquals(start_timestamp, '${r}')`:""}\n    ${i?`AND lessOrEquals(start_timestamp, '${i}')`:""}\n    GROUP BY transaction_id, transaction, description, user, domain, span_id\n    ORDER BY exclusive_time desc\n    LIMIT 10\n `},Ee=e=>{let{transactionName:t,datetime:n}=e;return`?field=count%28%29&query=transaction%3A${encodeURIComponent(t)}${n?n.period?`&statsPeriod=${n.period}`:n.start&&n.end?`&start=${encodeURIComponent(n.start.toISOString())}&end=${encodeURIComponent(n.end.toISOString())}`:null:null}&dataset=metricsEnhanced&project=1`},we=e=>{let{description:t,transactionName:n,datetime:a,groupId:s,module:r}=e;const{start_timestamp:i,end_timestamp:o}=(0,be.SW)(a);return`SELECT\n     toStartOfInterval(start_timestamp, INTERVAL 12 HOUR) as interval,\n     quantile(0.5)(exclusive_time) as p50,\n     quantile(0.95)(exclusive_time) as p95,\n     count() as count,\n     countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as failure_count,\n     failure_count / count as failure_rate\n     FROM spans_experimental_starfish\n     WHERE module = '${r}'\n     ${t?`AND description = '${t}'`:""}\n     ${s?`AND group_id = '${s}'`:""}\n     ${n?`AND transaction = '${n}'`:""}\n     ${i?`AND greaterOrEquals(start_timestamp, '${i}')`:""}\n     ${o?`AND lessOrEquals(start_timestamp, '${o}')`:""}\n     GROUP BY interval\n     ORDER BY interval asc\n  `},$e=e=>{let{description:t,transactionName:n,datetime:a,groupId:s,module:r}=e;const{start_timestamp:i,end_timestamp:o}=(0,be.SW)(a);return`\n    SELECT\n    count() AS count,\n    quantile(0.5)(exclusive_time) as p50,\n    quantile(0.95)(exclusive_time) as p95,\n    countIf(greaterOrEquals(status, 400) AND lessOrEquals(status, 599)) as failure_count,\n    failure_count / count() as failure_rate,\n    sum(exclusive_time) as total_exclusive_time,\n    count(DISTINCT transaction_id) as count_unique_transaction_id,\n    count(DISTINCT transaction) as count_unique_transaction,\n    min(timestamp) as first_seen,\n    max(timestamp) as last_seen\n    FROM spans_experimental_starfish\n    WHERE 1 == 1\n    ${r?`AND module = '${r}'`:""}\n    ${t?`AND description = '${t}'`:""}\n    ${s?`AND group_id = '${s}'`:""}\n    ${n?`AND transaction = '${n}'`:""}\n    ${i?`AND greaterOrEquals(start_timestamp, '${i}')`:""}\n    ${o?`AND lessOrEquals(start_timestamp, '${o}')`:""}\n    ORDER BY count DESC\n    LIMIT 5\n `};function Ne(e){let{spanGroupOperation:t,groupId:n,description:a,transactionName:s,sampledSpanData:i}=e;const o=(0,Se.u)(),p=(0,Z.Z)(),{getSeriesQuery:l}=function(e){switch(e){case"db":case"cache":return{getSeriesQuery:we,getAggregatesQuery:$e};case"http.client":return{getSeriesQuery:$.Zn,getAggregatesQuery:$.o_};default:return{getSeriesQuery:()=>"",getAggregatesQuery:()=>""}}}(t),c=t,d=l({description:a,transactionName:s,datetime:p.selection.datetime,groupId:n,module:c}),{isLoading:u,data:m}=(0,r.a)({queryKey:[d],queryFn:()=>fetch(`${N.M}/?query=${d}`).then((e=>e.json())),retry:!1,initialData:[]}),[h,g,f]=p.selection.datetime.period?.match(be.Pr)??[],_=g&&f?ye()().subtract(g,f):ye()(p.selection.datetime.start),S=ye()(p.selection.datetime.end??void 0),[x,v,b,D,E]=function(e){const t=[];return e.length>0&&Object.keys(e[0]).filter((e=>"interval"!==e)).forEach((e=>{t.push({seriesName:`${e}()`,data:[]})})),e.forEach((e=>{Object.keys(e).forEach((n=>{"interval"!==n&&t.find((e=>e.seriesName===`${n}()`))?.data.push({name:e.interval,value:e[n]})}))})),t}(m).map((e=>(0,De.b)(e,ye().duration(12,"hours"),_,S))),w=o.charts.getColorPalette(1),q=i.map((e=>{let{timestamp:t,spanDuration:n}=e;return{name:t,value:n}}));return(0,te.BX)("div",{children:[(0,te.tZ)("h3",{children:(0,y.t)("Span Duration")}),(0,te.tZ)(qe,{series:x&&v?[x,v]:[],isLoading:u,chartColor:w,sampledSpanDataSeries:q})]})}function qe(e){return(0,te.tZ)(ve.Z,{statsPeriod:"24h",height:400,data:e.series,start:"",end:"",loading:e.isLoading,utc:!1,stacked:!0,isLineChart:!0,disableXAxis:!0,hideYAxisSplitLine:!0,chartColors:e.chartColor,grid:{left:"0",right:"0",top:"8px",bottom:"16px"},scatterPlot:e.sampledSpanDataSeries.length?[{data:e.sampledSpanDataSeries,seriesName:"Sampled Span Duration"}]:void 0})}Ne.displayName="MegaChart",qe.displayName="ChartWrapper";var Re=n("./app/components/duration.tsx"),Oe=n("./app/utils/formatters.tsx");function Ce(e){let{spanGroupOperation:t,groupId:n,description:a,transactionName:s,sampledSpanData:i}=e;const o=(0,Se.u)(),p=(0,Z.Z)(),{getSeriesQuery:l,getAggregatesQuery:c}=function(e){switch(e){case"db":case"cache":default:return{getSeriesQuery:we,getAggregatesQuery:$e};case"http.client":return{getSeriesQuery:$.Zn,getAggregatesQuery:$.o_}}}(t),d=t,u=l({description:a,transactionName:s,datetime:p.selection.datetime,groupId:n,module:d}),h=c({description:a,transactionName:s,datetime:p.selection.datetime,groupId:n,module:d}),{isLoading:g,data:f}=(0,r.a)({queryKey:["span-aggregates"],queryFn:()=>fetch(`${N.M}/?query=${h}&referrer=sidebar-aggregates`).then((e=>e.json())),retry:!1,initialData:[]}),{isLoading:_,data:S}=(0,r.a)({queryKey:["overall-aggregates"],queryFn:()=>fetch(`${N.M}/?query=${function(e){const{start_timestamp:t,end_timestamp:n}=(0,be.SW)(e);return`\n    SELECT\n    count(DISTINCT transaction) AS count_overall_unique_transactions,\n    sum(exclusive_time) AS overall_total_exclusive_time\n    FROM spans_experimental_starfish\n    WHERE 1 == 1\n    ${t?`AND greaterOrEquals(start_timestamp, '${t}')`:""}\n    ${n?`AND lessOrEquals(start_timestamp, '${n}')`:""}\n  `}(p.selection.datetime)}&referrer=overall-aggregates`).then((e=>e.json())),retry:!1,initialData:[]}),{isLoading:x,data:v}=(0,r.a)({queryKey:["seriesdata"],queryFn:()=>fetch(`${N.M}/?query=${u}`).then((e=>e.json())),retry:!1,initialData:[]}),b=Ee({transactionName:s,datetime:p.selection.datetime}),{data:D,isLoading:E}=(0,r.a)({queryKey:[b],queryFn:()=>fetch(`/api/0/organizations/sentry/events/${b}`).then((e=>e.json())),retry:!1,initialData:[]}),{p50:w,p95:q,failure_rate:R,count:O,total_exclusive_time:C,count_unique_transaction_id:A,count_unique_transaction:T,first_seen:k,last_seen:I}=f[0]||{},{count_overall_unique_transactions:B,overall_total_exclusive_time:L}=S[0]||{},[j,P,M]=p.selection.datetime.period?.match(be.Pr)??[],X=P&&M?ye()().subtract(P,M):ye()(p.selection.datetime.start),F=ye()(p.selection.datetime.end??void 0),[H,W,U,Y,z]=function(e){const t=[];return e.length>0&&Object.keys(e[0]).filter((e=>"interval"!==e)).forEach((e=>{t.push({seriesName:`${e}()`,data:[]})})),e.forEach((e=>{Object.keys(e).forEach((n=>{"interval"!==n&&t.find((e=>e.seriesName===`${n}()`))?.data.push({name:e.interval,value:e[n]})}))})),t}(v).map((e=>(0,De.b)(e,ye().duration(12,"hours"),X,F))),G=A&&D?.data?.[0]?.["count()"]?A/D.data[0]["count()"]:0,Q=Math.round(100*(O&&D?.data?.[0]?.["count()"]?O/D.data[0]["count()"]:0))/100,V=o.charts.getColorPalette(2),K=i.map((e=>{let{timestamp:t,spanDuration:n}=e;return{name:t,value:n}}));return(0,te.BX)(Ae,{children:[(0,te.BX)(Te,{children:[(0,te.tZ)(Ie,{children:(0,y.t)("Total Self Time")}),(0,te.BX)(Be,{children:[(0,te.tZ)(Re.Z,{seconds:C/1e3,fixedDigits:2,abbreviation:!0})," ","(",(0,Oe.rl)(C/L),")"]})]}),(0,te.BX)(Te,{children:[(0,te.tZ)(Ie,{children:(0,y.t)("Unique Transactions")}),(0,te.BX)(Be,{children:[T," / ",B]})]}),(0,te.BX)(Te,{children:[(0,te.tZ)(Ie,{children:(0,y.t)("First Seen")}),(0,te.tZ)(Be,{children:(0,te.tZ)(m.Z,{date:k,timeZone:!0,seconds:!0,utc:!0})})]}),(0,te.BX)(Te,{children:[(0,te.tZ)(Ie,{children:(0,y.t)("Last Seen")}),(0,te.tZ)(Be,{children:(0,te.tZ)(m.Z,{date:I,timeZone:!0,seconds:!0,utc:!0})})]}),(0,te.BX)(Te,{children:[(0,te.tZ)(Ie,{children:(0,y.t)("Total Spans")}),(0,te.tZ)(Be,{children:O})]}),(0,te.BX)(Te,{children:[(0,te.tZ)(Ie,{children:(0,y.t)("Span Frequency")}),(0,te.tZ)(Be,{children:(0,Oe.rl)(G)})]}),(0,te.BX)(Te,{children:[(0,te.tZ)(Ie,{children:(0,y.t)("Spans Per Event")}),(0,te.tZ)(Be,{children:Q})]}),(0,te.BX)(ke,{children:[(0,te.tZ)(Ie,{children:(0,y.t)("Throughput")}),(0,te.tZ)(Be,{children:O}),(0,te.tZ)(Le,{series:U,isLoading:x,chartColor:V[0]})]}),(0,te.BX)(ke,{children:[(0,te.tZ)(Ie,{children:(0,y.t)("Self Time Duration (P50)")}),(0,te.tZ)(Be,{children:(0,te.tZ)(Re.Z,{seconds:w/1e3,fixedDigits:2,abbreviation:!0})}),(0,te.tZ)(Le,{series:H,isLoading:x,chartColor:V[1],sampledSpanDataSeries:K})]}),(0,te.BX)(ke,{children:[(0,te.tZ)(Ie,{children:(0,y.t)("Self Time Duration (P95)")}),(0,te.tZ)(Be,{children:(0,te.tZ)(Re.Z,{seconds:q/1e3,fixedDigits:2,abbreviation:!0})}),(0,te.tZ)(Le,{series:W,isLoading:x,chartColor:V[2],sampledSpanDataSeries:K})]}),"http.client"===t&&(0,te.BX)(ke,{children:[(0,te.tZ)(Ie,{children:(0,y.t)("Error Rate")}),(0,te.tZ)(Be,{children:(0,Oe.rl)(R)}),(0,te.tZ)(Le,{series:z,isLoading:x,chartColor:V[3]})]})]})}Ce.displayName="Sidebar";const Ae=(0,a.Z)("div",{target:"eq180hl4"})({name:"1o7d3sk",styles:"display:flex;align-items:center;flex-wrap:wrap"}),Te=(0,a.Z)("div",{target:"eq180hl3"})("flex:1 1 50%;margin-bottom:",(0,v.D)(4),";"),ke=(0,a.Z)("div",{target:"eq180hl2"})("flex:1 1 100%;margin-bottom:",(0,v.D)(4),";"),Ie=(0,a.Z)("h3",{target:"eq180hl1"})("color:",(e=>e.theme.gray300),";font-size:",(e=>e.theme.fontSizeMedium),";margin:0;margin-bottom:",(0,v.D)(.5),";"),Be=(0,a.Z)("h4",{target:"eq180hl0"})({name:"3in70x",styles:"margin:0;font-weight:normal"});function Le(e){return(0,te.tZ)(ve.Z,{statsPeriod:"24h",height:110,data:e.series?[e.series]:[],start:"",end:"",loading:e.isLoading,utc:!1,stacked:!0,isLineChart:!0,disableXAxis:!0,hideYAxisSplitLine:!0,chartColors:[e.chartColor],grid:{left:"0",right:"0",top:"8px",bottom:"16px"},scatterPlot:[{data:e.sampledSpanDataSeries,seriesName:"Sampled Span Duration"}]})}Le.displayName="SidebarChart";const je=[{key:"transaction_id",name:"Event ID",width:200},{key:"transaction",name:"Transaction",width:200},{key:"user",name:"User",width:200},{key:"timestamp",name:"Timestamp",width:300},{key:"duration",name:"Span Duration",width:200},{key:"p50_comparison",name:"Compared to P50",width:200},{key:"compare",name:"",width:50}];function Pe(e){let{location:t,params:n}=e;const[a,i]=(0,s.useState)({plotSamples:!1,megaChart:!1,leftComparisonEventId:void 0,rightComparisonEventId:void 0}),p=(0,Z.Z)(),h=n.groupId,v=t.query.transaction,q=t.query.user,R=(0,$.Z$)({groupId:h,datetime:p.selection.datetime}),{isLoading:O,data:C}=(0,r.a)({queryKey:["spanSummary",h],queryFn:()=>fetch(`${N.M}/?query=${R}`).then((e=>e.json())),retry:!1,initialData:[]}),A=(0,$.tC)({groupId:h,datetime:p.selection.datetime}),{isLoading:T,data:k}=(0,r.a)({queryKey:["facetBreakdown",h],queryFn:()=>fetch(`${N.M}/?query=${A}`).then((e=>e.json())),retry:!1,initialData:[]}),I=Ze({groupId:h,transactionName:v,user:q,datetime:p.selection.datetime}),{isLoading:B,data:L}=(0,r.a)({queryKey:["spanSamples",h,v,q,p.selection.datetime],queryFn:()=>fetch(`${N.M}/?query=${I}`).then((e=>e.json())),retry:!1,initialData:[]}),{data:j,isLoading:P}=(0,D.WE)([`/organizations/sentry/events/?field=id&field=timestamp&field=transaction.duration&field=project.name&query=id:[${L.map((e=>e.transaction_id.replaceAll("-",""))).join(",")}]&referrer=api.starfish.span-summary-table&sort=-transaction.duration&statsPeriod=14d`],{staleTime:0,enabled:L.length>0}),M=o()(j?.data,"id"),X=L?.[0]?.description,F=L?.[0]?.domain,H=C?.[0]?.span_operation,W=L.map((e=>{const t=M[e.transaction_id.replaceAll("-","")];return{transaction:e.transaction,transaction_id:e.transaction_id,"project.name":t?.["project.name"],span_id:e.span_id,timestamp:t?.timestamp,spanOp:e.span_operation,spanDuration:e.exclusive_time,transactionDuration:t?.["transaction.duration"]}}));return(0,te.tZ)(f.T3,{children:(0,te.BX)(b.V_,{children:[(0,te.tZ)(f.h4,{children:(0,te.tZ)(f.oB,{children:(0,te.tZ)(f.Dx,{children:h})})}),(0,te.tZ)(f.uT,{children:(0,te.BX)(f.or,{fullWidth:!0,children:[(0,te.tZ)(b.YY,{}),(0,te.BX)(We,{children:[(0,te.tZ)(u.Z,{alignDropdown:"left"}),(0,te.BX)(Ue,{children:[(0,te.tZ)(Ye,{active:a.megaChart,children:(0,y.t)("Show mega chart")}),(0,te.tZ)(S.Z,{isActive:a.megaChart,toggle:()=>{i({...a,megaChart:!a.megaChart})}}),(0,te.tZ)(Ye,{active:a.plotSamples,children:(0,y.t)("Plot samples on charts")}),(0,te.tZ)(S.Z,{isActive:a.plotSamples,toggle:()=>{i({...a,plotSamples:!a.plotSamples})}})]})]}),(0,te.BX)(Xe,{children:[(0,te.BX)(Fe,{children:[O?(0,te.tZ)("span",{children:"LOADING"}):(0,te.BX)("div",{children:[(0,te.tZ)("h3",{children:(0,y.t)("Info")}),(0,te.tZ)(Ge,{data:C,spanGroupOperation:H,spanDescription:X,spanDomain:F,transactionName:v})]}),a.megaChart&&(0,te.tZ)(Ne,{groupId:h,spanGroupOperation:H,description:null,transactionName:v,sampledSpanData:a.plotSamples?W:[]}),T?(0,te.tZ)("span",{children:"LOADING"}):(0,te.BX)("div",{children:[(0,te.tZ)("h3",{children:(0,y.t)("Facets")}),["transaction","user"].map((e=>{const t=k.map((t=>t[e])),n=Array.from(new Set(t));let a=0;const s=l()(n.map((n=>{const s=t.filter((e=>e===n)).length;return a+=s,{key:e,name:n,value:n,url:`/starfish/span/${h}?${c.stringify({[e]:n})}`,count:s}})),"count","desc");return(0,te.tZ)(x.Z,{title:e,segments:s,totalValues:a},e)}))]}),(a.leftComparisonEventId||a.rightComparisonEventId)&&(0,te.tZ)(ue,{left:a.leftComparisonEventId,right:a.rightComparisonEventId,clearLeft:()=>{i({...a,leftComparisonEventId:void 0})},clearRight:()=>{i({...a,rightComparisonEventId:void 0})}}),B?(0,te.tZ)("span",{children:"LOADING SAMPLE LIST"}):(0,te.BX)("div",{children:[(0,te.tZ)("h3",{children:(0,y.t)("Samples")}),(0,te.tZ)(g.ZP,{isLoading:O||P,data:W,columnOrder:je,columnSortBy:[],grid:{renderHeadCell:function(e){return"p50_comparison"===e.key?(0,te.tZ)(w.Dq,{children:(0,te.tZ)(Me,{children:e.name})}):(0,te.tZ)(Me,{children:e.name})},renderBodyCell:(e,t)=>function(e,t,n){if("transaction_id"===e.key)return(0,te.tZ)(_.Z,{to:`/performance/${t["project.name"]}:${t.transaction_id}#span-${t.span_id.slice(19).replace("-","")}`,children:t.transaction_id.slice(0,8)});if("duration"===e.key)return(0,te.tZ)(E.i,{spanOp:t.spanOp,spanDuration:t.spanDuration,transactionDuration:t.transactionDuration});if("p50_comparison"===e.key){const{p50:e}=C[0],n=t.spanDuration-e;if(n===e)return"At baseline";const a=n>0?`+${n.toFixed(2)}ms above`:`${n.toFixed(2)}ms below`;return(0,te.tZ)(ze,{value:n,children:a})}return"timestamp"===e.key?(0,te.tZ)(m.Z,{date:t.timestamp,year:!0,timeZone:!0,seconds:!0}):"compare"===e.key?(0,te.tZ)(d.zx,{onClick:()=>{var e;e=t.transaction_id,a.leftComparisonEventId?i({...a,rightComparisonEventId:e}):i({...a,leftComparisonEventId:e})},children:(0,y.t)("View")}):(0,te.tZ)("span",{children:t[e.key]})}(e,t)},location:t})]})]}),(0,te.tZ)(He,{children:(0,te.tZ)(Ce,{groupId:h,spanGroupOperation:H,description:null,transactionName:v,sampledSpanData:a.plotSamples?W:[]})})]})]})})]})})}Pe.displayName="SpanSummary";const Me=(0,a.Z)("span",{target:"e1ysathp7"})({name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"}),Xe=(0,a.Z)("div",{target:"e1ysathp6"})("display:flex;flex-wrap:wrap;gap:",(0,v.D)(4),";"),Fe=(0,a.Z)("div",{target:"e1ysathp5"})({name:"185jlqp",styles:"flex:100 0 800px"}),He=(0,a.Z)("div",{target:"e1ysathp4"})({name:"lrmjb3",styles:"flex:1 1 300px"}),We=(0,a.Z)("div",{target:"e1ysathp3"})("display:flex;flex-direction:row;gap:",(0,v.D)(1),";align-items:center;margin-bottom:",(0,v.D)(2),";"),Ue=(0,a.Z)("div",{target:"e1ysathp2"})("display:flex;flex-direction:row;gap:",(0,v.D)(1),";align-items:center;flex:1;justify-content:flex-end;"),Ye=(0,a.Z)("span",{target:"e1ysathp1"})("font-size:",(e=>e.theme.fontSizeSmall),";color:",(e=>e.active?e.theme.purple300:e.theme.gray300),";"),ze=(0,a.Z)("div",{target:"e1ysathp0"})("text-align:right;color:",(e=>e.value<0?e.theme.green400:e.theme.red400),";");function Ge(e){let{spanDescription:t,spanGroupOperation:n,spanDomain:a}=e;switch(n){case"db":case"cache":return(0,te.tZ)(h.Z,{data:[{key:"desc",value:t,subject:"Full Query"},{key:"domain",value:a,subject:"Table Columns"}],shouldSort:!1});case"http.client":return(0,te.tZ)(h.Z,{data:[{key:"desc",value:t,subject:"URL"},{key:"domain",value:a,subject:"Domain"}],shouldSort:!1});default:return null}}}}]);
//# sourceMappingURL=../sourcemaps/app_components_charts_lineChart_tsx-app_views_starfish_views_spanSummary_index_tsx.4df03f48ac399a8a5f81b6333e5d201d.js.map