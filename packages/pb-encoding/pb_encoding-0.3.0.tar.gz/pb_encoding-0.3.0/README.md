Some encode/decode functions extracted from google.protobuf