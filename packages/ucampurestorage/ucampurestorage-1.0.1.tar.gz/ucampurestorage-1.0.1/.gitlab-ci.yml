stages:
  - build
  - syntax_validation
  - pytest

# build image for pytest
build_pytest:
  stage: build
  tags:
    - im530
  script:
    - sudo docker build -t pytest -f compose/pytest.Dockerfile .

# build image for pytest
build_tox:
  stage: build
  tags:
    - im530
  script:
    - sudo docker-compose --file compose/tox.yml build

# Test code coverage
flake8:
  stage: syntax_validation
  script:
    - sudo docker-compose --file compose/tox.yml up --exit-code-from tox


pytest:
  stage: pytest
  tags:
    - im530
  image: pytest
  needs:
    - flake8
  script:
    - sudo docker run pytest