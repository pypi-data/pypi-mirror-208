from typing import Optional
import pathlib

from .teeconn import TeeHTTPConnection, TeeHTTPResponse


def http_request(filepath: pathlib.Path, method: str, host: str, path: str, port: Optional[str | int]=None) -> TeeHTTPResponse:
    """
    Makes a HTTP request to the given host and path, and saves the response to the given filename,
    but also returns the HTTP response object.

    If port is not given, it will be inferred from the scheme.
    """
    conn = TeeHTTPConnection(filepath, host, port)
    conn.request(method, path)
    return conn.getresponse()


